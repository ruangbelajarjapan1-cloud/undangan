<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#1A56FF" />
  <title>RBM Japan • Graduation</title>

  <link rel="icon" href="data:,">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700;800&family=Noto+Sans+JP:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
:root{
  --sky1:#BFEFFF;
  --sky2:#EAFBFF;
  --sky3:#86D7FF;
  --sky4:#5FB8FF;

  --accent:#00B7FF;
  --accent2:#2D7DFF;

  --text:#08324A;
  --muted: rgba(8,50,74,.72);
  --textInv:#FFFFFF;

  --cardBg: rgba(255,255,255,.86);
  --glass: rgba(255,255,255,.66);

  --shadow: 0 18px 55px rgba(0,60,120,.14);
  --shadow2: 0 14px 40px rgba(0,60,120,.10);

  --r: 22px;
  --tap: 46px;
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family:"Noto Sans","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color: var(--text);
  overflow-x:hidden;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  font-size: 16px;

  background:
    radial-gradient(900px 600px at 15% 15%, rgba(255,255,255,.95), transparent 60%),
    radial-gradient(900px 600px at 85% 25%, rgba(134,215,255,.65), transparent 60%),
    radial-gradient(900px 600px at 20% 85%, rgba(191,239,255,.70), transparent 65%),
    linear-gradient(140deg, var(--sky1), var(--sky2));

  background-size: 160% 160%;
  animation: bgShiftKids 10s ease-in-out infinite alternate;
}
@keyframes bgShiftKids{
  0%{ background-position: 0% 40%; filter:saturate(1.10) brightness(1.06); }
  100%{ background-position: 100% 65%; filter:saturate(1.16) brightness(1.10); }
}

body:not(.opened){ overflow: hidden; }

a{ color:inherit; }
.container{
  max-width: 980px;
  margin: 0 auto;
  padding: 16px 14px calc(92px + env(safe-area-inset-bottom));
}

body::before,
body::after{
  content:"";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
}
body::before{
  background:
    radial-gradient(circle at 10% 20%, rgba(255,255,255,.70) 0 2px, transparent 3px),
    radial-gradient(circle at 35% 40%, rgba(255,255,255,.55) 0 2px, transparent 3px),
    radial-gradient(circle at 60% 25%, rgba(255,255,255,.60) 0 2px, transparent 3px),
    radial-gradient(circle at 80% 55%, rgba(255,255,255,.50) 0 2px, transparent 3px),
    radial-gradient(circle at 20% 75%, rgba(255,255,255,.55) 0 2px, transparent 3px);
  opacity: .22;
  animation: sparkleDrift 14s linear infinite;
}
body::after{
  background:
    radial-gradient(circle at 15% 30%, rgba(0,183,255,.30) 0 2px, transparent 3px),
    radial-gradient(circle at 70% 35%, rgba(45,125,255,.22) 0 2px, transparent 3px),
    radial-gradient(circle at 85% 80%, rgba(134,215,255,.28) 0 2px, transparent 3px);
  opacity: .16;
  animation: sparkleDrift2 18s linear infinite;
}
@keyframes sparkleDrift{
  0%{ transform: translate3d(0,0,0); }
  100%{ transform: translate3d(-4vw, 6vh, 0); }
}
@keyframes sparkleDrift2{
  0%{ transform: translate3d(0,0,0); }
  100%{ transform: translate3d(5vw, -5vh, 0); }
}

.bubbles{
  position: fixed;
  inset: 0;
  pointer-events:none;
  overflow:hidden;
  z-index: 0;
}
.bubble{
  position:absolute;
  width: 22vmin;
  height: 22vmin;
  border-radius: 999px;
  opacity:.22;
  border: 1px solid rgba(255,255,255,.40);
  animation: floatUp 12s linear infinite;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.80), rgba(255,255,255,.10));
  box-shadow: 0 18px 55px rgba(0,60,120,.10);
}
.bubbles .bubble:nth-child(1){ filter: drop-shadow(0 0 18px rgba(0,183,255,.22)); }
.bubbles .bubble:nth-child(2){ filter: drop-shadow(0 0 18px rgba(45,125,255,.18)); }
.bubbles .bubble:nth-child(3){ filter: drop-shadow(0 0 18px rgba(134,215,255,.20)); }
.bubbles .bubble:nth-child(4){ filter: drop-shadow(0 0 18px rgba(95,184,255,.18)); }
@keyframes floatUp{
  0%{ transform: translate3d(0, 110vh, 0) scale(.85); }
  100%{ transform: translate3d(10vw, -30vh, 0) scale(1.12); }
}

/* ===== Floating Stickers ===== */
.stickers{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 1;
  overflow: hidden;
}
.sticker{
  position: absolute;
  top: -120px; /* penting: biar posisi konsisten */
  width: var(--s, 72px);
  height: var(--s, 72px);
  opacity: var(--o, .18);
  transform: translate3d(0,0,0);
  filter: drop-shadow(0 12px 24px rgba(0,60,120,.12));
  animation: stickerFloat var(--t, 16s) ease-in-out infinite;
}
.sticker.cloud{
  background:
    radial-gradient(circle at 32% 58%, rgba(255,255,255,.95) 0 22%, transparent 24%),
    radial-gradient(circle at 52% 44%, rgba(255,255,255,.95) 0 28%, transparent 30%),
    radial-gradient(circle at 72% 58%, rgba(255,255,255,.95) 0 20%, transparent 22%),
    radial-gradient(60% 55% at 52% 70%, rgba(255,255,255,.95) 0 55%, transparent 57%);
  border-radius: 999px;
}
.sticker.star{
  background: rgba(0,183,255,.22);
  clip-path: polygon(
    50% 0%,
    62% 34%,
    98% 35%,
    69% 57%,
    80% 92%,
    50% 72%,
    20% 92%,
    31% 57%,
    2% 35%,
    38% 34%
  );
}
.sticker.star.soft{ background: rgba(45,125,255,.18); }

@keyframes stickerFloat{
  0%   { transform: translate3d(var(--x,0px), 110vh, 0) rotate(0deg) scale(.98); }
  50%  { transform: translate3d(calc(var(--x,0px) + 10px), 48vh, 0) rotate(8deg) scale(1.03); }
  100% { transform: translate3d(calc(var(--x,0px) - 10px), -25vh, 0) rotate(-6deg) scale(.99); }
}

/* Top bar */
.topbar{
  position: sticky; top: 0; z-index: 20;
  backdrop-filter: blur(12px);
  background: rgba(255,255,255,.72);
  border-bottom: 1px solid rgba(0,183,255,.18);
}
.topbar-inner{
  max-width: 980px; margin:0 auto;
  padding: 10px 14px;
  display:flex; align-items:center; justify-content:space-between; gap: 10px;
}
.brand{ display:flex; align-items:center; gap:10px; min-width: 240px; }
.logo{
  width: 44px; height: 44px;
  border-radius: 16px;
  overflow:hidden;
  background: rgba(255,255,255,.85);
  border: 1px solid rgba(0,183,255,.18);
  box-shadow: var(--shadow2);
}
.logo img{ width:100%; height:100%; object-fit:cover; display:block; }
.brand h1{ margin:0; font-size:14px; font-weight:900; line-height:1.1; color: var(--text); }
.brand p{ margin:2px 0 0; font-size:12px; color: var(--muted); }

.right{ display:flex; align-items:center; gap:8px; }

.chip{
  height: 34px;
  padding: 0 10px;
  border-radius: 999px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.70);
  color: rgba(8,50,74,.90);
  display:inline-flex; align-items:center; justify-content:center;
  font-size: 12px;
  cursor: pointer;
  user-select:none;
  transition: transform .12s ease, background .2s ease;
}
.chip:active{ transform: scale(.98); }
.chip.active{
  background: linear-gradient(90deg, rgba(0,183,255,.95), rgba(45,125,255,.92));
  border-color: rgba(0,183,255,.22);
  color: #fff;
}

.iconBtn{
  width: 38px; height: 38px;
  border-radius: 14px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.70);
  color: rgba(8,50,74,.95);
  display:grid; place-items:center;
  cursor:pointer; user-select:none;
  transition: transform .12s ease, background .2s ease;
}
.iconBtn:active{ transform: scale(.98); }
.iconBtn:hover{ background: rgba(255,255,255,.85); }

/* Cover */
.coverWrap{
  position: fixed;
  inset: 0;
  z-index: 50;
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 18px 14px;
  background: rgba(8,50,74,.14);
  backdrop-filter: blur(12px);
  transition: opacity .55s ease, transform .55s ease;
}
body.opened .coverWrap{
  opacity: 0;
  transform: translateY(-10px);
  pointer-events:none;
}

.coverCard{
  width: min(980px, 100%);
  border-radius: 28px;
  overflow:hidden;
  border: 1px solid rgba(0,183,255,.18);
  box-shadow: var(--shadow);
  background: rgba(255,255,255,.92);
  position:relative;
  transform: translateY(8px);
  animation: popIn .7s ease both;
}
@keyframes popIn{
  from{ opacity:0; transform: translateY(18px) scale(.98); }
  to{ opacity:1; transform: translateY(0) scale(1); }
}

.coverMedia{
  height: 360px;
  position:relative;
  background:#cfefff;
}
.slide{
  position:absolute; inset:0;
  background-size: cover;
  background-position:center;
  transform: scale(1.08);
  opacity:0;
  transition: opacity 1.1s ease;
  animation: kenburns 16s ease-in-out infinite;
  filter: saturate(1.05) contrast(1.02);
}
.slide.active{ opacity:1; }
@keyframes kenburns{
  0%{ transform: scale(1.08) translate3d(0,0,0); }
  50%{ transform: scale(1.16) translate3d(-1.6%, -1.1%, 0); }
  100%{ transform: scale(1.08) translate3d(0,0,0); }
}
.coverMedia::after{
  content:"";
  position:absolute; inset:0;
  background: linear-gradient(180deg, rgba(255,255,255,.00) 0%, rgba(255,255,255,.70) 60%, rgba(255,255,255,.92) 100%);
}

.coverBody{ position:relative; padding: 18px 16px 16px; }
.badgeRow{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
.badge{
  font-size: 12px;
  padding: 7px 10px;
  border-radius: 999px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.78);
  color: rgba(8,50,74,.90);
}
.toLine{ margin-top: 10px; font-size: 12px; color: var(--muted); }
.coverTitle{
  margin: 6px 0 8px;
  font-size: clamp(22px, 4.5vw, 40px);
  line-height: 1.12;
  font-weight: 950;
  letter-spacing:.2px;
  color: var(--text);
}
.coverDesc{
  margin: 0;
  color: rgba(8,50,74,.80);
  font-size: 14px;
  line-height: 1.7;
  max-width: 72ch;
}
.btnRow{
  margin-top: 14px;
  display:flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items:center;
}

/* Buttons + ripple */
.btn{
  min-height: var(--tap);
  padding: 0 14px;
  border-radius: 16px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.82);
  color: rgba(8,50,74,.92);
  font-weight: 900;
  font-size: 13px;
  cursor:pointer;
  user-select:none;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 10px;
  position:relative;
  overflow:hidden;
  transition: transform .12s ease, background .2s ease, box-shadow .2s ease;
  box-shadow: 0 10px 26px rgba(0,60,120,.08);
}
.btn:hover{ background: rgba(255,255,255,.95); }
.btn:active{ transform: scale(.99); }

.btn.primary{
  background: linear-gradient(90deg, rgba(0,183,255,.98), rgba(45,125,255,.94));
  border-color: rgba(0,183,255,.22);
  color: #fff;
  box-shadow: 0 14px 34px rgba(0,60,120,.14);
  animation: btnGlow 2.6s ease-in-out infinite alternate;
}
@keyframes btnGlow{
  0%{ transform: translateY(0); filter: brightness(1); }
  100%{ transform: translateY(-1px); filter: brightness(1.05); }
}
.btn.ok{
  background: rgba(16,185,129,.12);
  border-color: rgba(16,185,129,.22);
  color: rgba(8,50,74,.92);
}
.btn.danger{
  background: rgba(244,63,94,.10);
  border-color: rgba(244,63,94,.20);
  color: rgba(8,50,74,.92);
}

.ripple{
  position:absolute;
  border-radius: 999px;
  transform: scale(0);
  animation: ripple .55s ease-out;
  background: rgba(255,255,255,.70);
  pointer-events:none;
  mix-blend-mode: overlay;
}
@keyframes ripple{ to{ transform: scale(6); opacity:0; } }

/* Cards */
.section{ margin-top: 14px; position:relative; z-index: 5; }
.card{
  position: relative;
  z-index: 5;
  border-radius: var(--r);
  border: 1px solid transparent;
  overflow:hidden;
  background:
    linear-gradient(var(--cardBg), var(--cardBg)) padding-box,
    linear-gradient(90deg, rgba(0,183,255,.70), rgba(45,125,255,.55)) border-box;
  background-size: 100% 100%, 220% 220%;
  background-position: 0 0, 0% 50%;
  animation: cardBorderShimmer 7s ease-in-out infinite alternate;
  box-shadow: var(--shadow);
}
@keyframes cardBorderShimmer{
  0%   { background-position: 0 0, 0% 50%; }
  100% { background-position: 0 0, 100% 50%; }
}
.cardBody{ padding: 16px; }
.card h2{
  margin:0 0 10px;
  font-size: 15px;
  font-weight: 950;
  letter-spacing:.2px;
  color: rgba(8,50,74,.98);
}

.mutedText{ color: var(--muted); font-size: 12px; line-height: 1.6; }
.hr{ height:1px; background: rgba(0,183,255,.18); margin: 12px 0; }
.notice{
  border-radius: 18px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.78);
  padding: 12px 12px;
  color: rgba(8,50,74,.92);
  font-size: 13px;
  line-height: 1.6;
}
.notice b{ font-weight: 950; }

.grid{ display:grid; grid-template-columns: 1.2fr .8fr; gap: 14px; }
@media (max-width: 900px){ .grid{ grid-template-columns: 1fr; } }

.kv{
  display:grid;
  grid-template-columns: 140px 1fr;
  gap: 8px 12px;
  font-size: 13px;
  align-items:start;
  color: rgba(8,50,74,.92);
}
@media (max-width: 520px){
  .kv{ grid-template-columns: 1fr; font-size: 14px; }
  .mutedText{ font-size: 13px; }
}

/* Countdown */
.countdown{
  display:grid;
  grid-template-columns: repeat(4,1fr);
  gap: 10px;
  margin-top: 8px;
}
.cdBox{
  text-align:center;
  padding: 10px 8px;
  border-radius: 18px;
  border:1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.78);
}
.cdNum{
  font-size: 20px;
  font-weight: 950;
  color: rgba(8,50,74,.95);
}
.cdLbl{ font-size: 11px; color: var(--muted); margin-top:4px; }

/* Hadith */
.arabic{
  font-size: 18px;
  line-height: 1.9;
  direction: rtl;
  text-align:right;
  padding: 10px 12px;
  border-radius: 18px;
  background: rgba(0,183,255,.10);
  border: 1px solid rgba(0,183,255,.18);
  margin: 8px 0 10px;
  color: rgba(8,50,74,.95);
}
.quote{
  font-size:13px;
  line-height:1.7;
  color: rgba(8,50,74,.90);
}
.source{ font-size:12px; color: var(--muted); margin-top:10px; }

/* Classes */
.classGrid{ display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
@media (max-width: 900px){ .classGrid{ grid-template-columns: repeat(2,1fr); } }
@media (max-width: 520px){ .classGrid{ grid-template-columns: 1fr; } }
.classCard{
  border:1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.78);
  border-radius: 18px;
  padding: 12px;
}
.classCard b{ display:block; font-weight: 950; color: rgba(8,50,74,.95); }
.classCard .small{ font-size:12px; color: var(--muted); margin-top:6px; line-height:1.6; }

/* Carousel */
.carousel{
  position: relative;
  overflow: hidden;
  border-radius: 22px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.72);
}
.carouselTrack{
  display: flex;
  transition: transform .55s cubic-bezier(.2,.9,.2,1);
  will-change: transform;
}
.carouselItem{ min-width: 100%; aspect-ratio: 16 / 10; position: relative; user-select: none; }
@media (max-width: 520px){ .carouselItem{ aspect-ratio: 16 / 12; } }
.carouselItem img{ width: 100%; height: 100%; object-fit: cover; display: block; transform: scale(1.02); }
.carouselItem::after{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(180deg, rgba(255,255,255,.00), rgba(255,255,255,.10));
  pointer-events:none;
}
.carouselCtrl{
  position:absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 3;
  width: 44px;
  height: 44px;
  border-radius: 16px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.78);
  color: rgba(8,50,74,.95);
  display:grid;
  place-items:center;
  cursor:pointer;
  user-select:none;
}
.carouselCtrl:active{ transform: translateY(-50%) scale(.98); }
.carouselCtrl.prev{ left: 10px; }
.carouselCtrl.next{ right: 10px; }

.carouselDots{
  position:absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: 10px;
  display:flex;
  gap: 6px;
  z-index: 3;
  padding: 6px 8px;
  border-radius: 999px;
  background: rgba(255,255,255,.72);
  border: 1px solid rgba(0,183,255,.18);
  backdrop-filter: blur(10px);
}
.dot{ width: 7px; height: 7px; border-radius: 999px; background: rgba(8,50,74,.25); cursor:pointer; }
.dot.active{ background: rgba(8,50,74,.70); }

/* Lightbox */
.lightbox{
  position:fixed; inset:0; z-index: 70;
  background: rgba(8,50,74,.62);
  display:none;
  align-items:center; justify-content:center;
  padding: 18px;
}
.lightbox.show{ display:flex; }
.lightbox img{
  max-width: min(980px, 94vw);
  max-height: 84vh;
  border-radius: 22px;
  border:1px solid rgba(0,183,255,.18);
  box-shadow: var(--shadow);
  background:#fff;
}

/* Forms */
form{ display:grid; gap:10px; }
label{ font-size:12px; color: rgba(8,50,74,.90); }
input, select, textarea{
  width:100%;
  min-height: var(--tap);
  padding: 10px 12px;
  border-radius: 16px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.88);
  color: rgba(8,50,74,.92);
  outline:none;
  box-shadow: 0 10px 22px rgba(0,60,120,.06);
}
input:focus, select:focus, textarea:focus{
  border-color: rgba(0,183,255,.40);
  box-shadow: 0 0 0 3px rgba(0,183,255,.16), 0 10px 22px rgba(0,60,120,.06);
}
textarea{ min-height: 92px; resize: vertical; }
.row2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
@media (max-width: 520px){ .row2{ grid-template-columns: 1fr; } }

.radioRow{ display:flex; flex-wrap:wrap; gap:10px; }
.radio{
  min-height: var(--tap);
  display:flex; gap:8px; align-items:center;
  padding: 10px 12px;
  border-radius: 16px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.80);
  cursor:pointer;
  user-select:none;
  font-size: 13px;
  color: rgba(8,50,74,.90);
}
.radio input{ width:auto; }

/* Reveal */
.reveal{
  opacity: 0;
  transform: translateY(14px) scale(.995);
  transition: opacity .65s ease, transform .65s cubic-bezier(.2,.9,.2,1);
}
.reveal.show{ opacity: 1; transform: translateY(0) scale(1); }

/* Bottom nav */
.bottomNav{
  position: fixed;
  left: 50%;
  bottom: calc(10px + env(safe-area-inset-bottom));
  transform: translateX(-50%);
  z-index: 25;
  width: min(520px, calc(100vw - 18px));
  border-radius: 22px;
  background: rgba(255,255,255,.76);
  border: 1px solid rgba(0,183,255,.18);
  backdrop-filter: blur(12px);
  box-shadow: var(--shadow);
  display:flex;
  justify-content:space-between;
  padding: 8px;
  gap: 6px;
}
.navItem{
  flex:1;
  min-height: 44px;
  border-radius: 16px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap: 4px;
  font-size: 10px;
  color: rgba(8,50,74,.82);
  text-decoration:none;
  border: 1px solid transparent;
}
.navItem.active{
  background: rgba(0,183,255,.12);
  border-color: rgba(0,183,255,.18);
}
.navItem svg{ width: 18px; height: 18px; opacity:.95; }

/* Toast */
.toast{
  position: fixed;
  right: 14px;
  bottom: calc(90px + env(safe-area-inset-bottom));
  z-index: 90;
  background: rgba(255,255,255,.86);
  border: 1px solid rgba(0,183,255,.18);
  border-radius: 18px;
  padding: 12px 12px;
  box-shadow: var(--shadow);
  max-width: 420px;
  display:none;
  backdrop-filter: blur(12px);
  color: rgba(8,50,74,.92);
}
.toast.show{ display:block; }

/* Confetti */
#confetti{
  position: fixed;
  inset: 0;
  pointer-events:none;
  z-index: 65;
  display:none;
}
body.opened #confetti{ display:block; }

@media (prefers-reduced-motion: reduce){
  body{ animation:none; }
  .slide{ animation:none; }
  .reveal{ transition:none; }
  .bubble{ animation:none; }
  .carouselTrack{ transition:none; }
  .sticker{ animation:none; }
}
  </style>
</head>

<body>
  <div class="bubbles" aria-hidden="true">
    <div class="bubble" style="left:5%; animation-delay:0s; width:18vmin; height:18vmin;"></div>
    <div class="bubble" style="left:30%; animation-delay:2s; width:22vmin; height:22vmin;"></div>
    <div class="bubble" style="left:65%; animation-delay:4s; width:16vmin; height:16vmin;"></div>
    <div class="bubble" style="left:82%; animation-delay:1s; width:24vmin; height:24vmin;"></div>
  </div>

  <!-- Stickers: cukup 1 blok saja -->
  <div class="stickers" aria-hidden="true">
    <div class="sticker cloud" style="left:6%;  --s:92px; --o:.18; --t:18s; --x:0px;  animation-delay:-3s;"></div>
    <div class="sticker star"  style="left:18%; --s:56px; --o:.16; --t:15s; --x:10px; animation-delay:-8s;"></div>
    <div class="sticker cloud" style="left:72%; --s:86px; --o:.16; --t:20s; --x:-8px; animation-delay:-6s;"></div>
    <div class="sticker star soft" style="left:86%; --s:48px; --o:.14; --t:16s; --x:6px;  animation-delay:-10s;"></div>
  </div>

  <canvas id="confetti"></canvas>

  <!-- Cover -->
  <div class="coverWrap" id="coverWrap">
    <div class="coverCard" role="dialog" aria-modal="true" aria-label="Undangan">
      <div class="coverMedia">
        <div class="slide active" id="slideA"></div>
        <div class="slide" id="slideB"></div>
      </div>
      <div class="coverBody">
        <div class="badgeRow">
          <div class="badge" data-i18n="badge_event">Acara Kelulusan</div>
          <div class="badge" id="badgeDate">24 Januari 2026</div>
          <div class="badge">十日市場地区センター</div>
        </div>

        <div class="toLine" id="toLine" data-i18n="to_default">Kepada Yth: Tamu Undangan</div>
        <div class="coverTitle" data-i18n="cover_title">Undangan Kelulusan Siswa RBM Japan</div>
        <p class="coverDesc" data-i18n="cover_desc">
          Klik tombol di bawah untuk membuka undangan dan mengisi daftar kehadiran/RSVP.
        </p>

        <div class="btnRow">
          <button class="btn primary" id="btnOpen" type="button" data-i18n="btn_open">Buka Undangan</button>
          <button class="btn" id="btnShare" type="button" data-i18n="btn_share">Bagikan</button>
          <a class="btn" id="btnMap" target="_blank" rel="noopener" data-i18n="btn_map">Buka Peta</a>
          <button class="btn" id="btnCalendar" type="button" data-i18n="btn_calendar">Tambah ke Kalender</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Top bar -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo">
          <img src="./assets/logo.png" alt="RBM Japan Logo" />
        </div>
        <div>
          <h1 data-i18n="top_title">RBM Japan • Kelulusan</h1>
          <p data-i18n="top_sub">Undangan Web + RSVP</p>
        </div>
      </div>

      <div class="right">
        <div class="chip active" data-lang="id">ID</div>
        <div class="chip" data-lang="en">EN</div>
        <div class="chip" data-lang="ja">日本語</div>
        <div class="iconBtn" id="btnMusic" title="Music">♪</div>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="container">
    <section class="section card reveal" id="detail">
      <div class="cardBody">
        <h2 data-i18n="sec_detail">Detail Acara</h2>

        <div class="kv">
          <div class="mutedText" data-i18n="k_when">Waktu</div>
          <div id="whenText"></div>

          <div class="mutedText" data-i18n="k_where">Tempat</div>
          <div>
            <div><b>十日市場地区センター</b></div>
            <div class="mutedText" id="addrText"></div>
          </div>

          <div class="mutedText" data-i18n="k_access">Akses</div>
          <div data-i18n="access_text">± 5–6 menit jalan kaki dari JR 横浜線 十日市場駅.</div>
        </div>

        <div class="hr"></div>

        <h2 data-i18n="sec_countdown">Hitung Mundur</h2>
        <div class="countdown" aria-live="polite">
          <div class="cdBox"><div class="cdNum" id="cdDays">—</div><div class="cdLbl" data-i18n="cd_days">Hari</div></div>
          <div class="cdBox"><div class="cdNum" id="cdHours">—</div><div class="cdLbl" data-i18n="cd_hours">Jam</div></div>
          <div class="cdBox"><div class="cdNum" id="cdMins">—</div><div class="cdLbl" data-i18n="cd_mins">Menit</div></div>
          <div class="cdBox"><div class="cdNum" id="cdSecs">—</div><div class="cdLbl" data-i18n="cd_secs">Detik</div></div>
        </div>

        <div class="hr"></div>

        <div class="quote" data-i18n="note_text">
          Dress code rapi & sopan. Mohon hadir 15 menit lebih awal untuk registrasi.
        </div>
      </div>
    </section>

    <section class="section grid">
      <div class="card reveal" id="hadith">
        <div class="cardBody">
          <h2 data-i18n="sec_hadith">Kutipan Hadits Shahih</h2>
          <div class="arabic">
            وَمَنْ سَلَكَ طَرِيقًا يَلْتَمِسُ فِيهِ عِلْمًا سَهَّلَ اللَّهُ لَهُ بِهِ طَرِيقًا إِلَى الْجَنَّةِ
          </div>
          <div class="quote" id="hadithTranslation"></div>
          <div class="source" id="hadithSource"></div>
        </div>
      </div>

      <div class="card reveal" id="kelas">
        <div class="cardBody">
          <h2 data-i18n="sec_classes">Kelas yang Diwisuda</h2>
          <div class="mutedText" data-i18n="classes_desc">Berikut daftar kelas (bisa ditambah kapan saja).</div>
          <div class="hr"></div>
          <div class="classGrid" id="classGrid"></div>
        </div>
      </div>
    </section>

    <section class="section card reveal" id="gallery">
      <div class="cardBody">
        <h2 data-i18n="sec_gallery">Galeri</h2>
        <div class="mutedText" data-i18n="gallery_desc">
         Galeri RBM Japan
        </div>
        <div class="hr"></div>

        <div class="carousel" id="galleryCarousel">
          <div class="carouselTrack" id="carouselTrack"></div>

          <button class="carouselCtrl prev" id="carPrev" type="button" aria-label="prev">‹</button>
          <button class="carouselCtrl next" id="carNext" type="button" aria-label="next">›</button>

          <div class="carouselDots" id="carouselDots"></div>
        </div>
      </div>
    </section>

    <div class="lightbox" id="lightbox" aria-hidden="true">
      <img id="lightboxImg" alt="preview" />
    </div>

    <section class="section card reveal" id="rsvp">
      <div class="cardBody">
        <h2 data-i18n="sec_rsvp">RSVP (Konfirmasi Kehadiran)</h2>
        <div class="mutedText" data-i18n="rsvp_hint">Isi form di bawah.</div>

        <div class="notice">
          <b data-i18n="men_notice_title">Pengumuman:</b>
          <span data-i18n="men_notice_body">Untuk Bapak-bapak, mohon menunggu di luar ruangan.</span>
        </div>

        <div class="hr"></div>

        <form id="rsvpForm">
          <div class="row2">
            <div>
              <label data-i18n="f_name">Nama</label>
              <input name="name" autocomplete="name" required placeholder="Nama Anda" />
            </div>
            <div>
              <label data-i18n="f_contact">Kontak (Email / WhatsApp)</label>
              <input name="contact" autocomplete="email" placeholder="opsional" />
            </div>
          </div>

          <div>
            <label data-i18n="f_attendance">Kehadiran</label>
            <div class="radioRow">
              <label class="radio"><input type="radio" name="attendance" value="yes" required /><span data-i18n="att_yes">Hadir</span></label>
              <label class="radio"><input type="radio" name="attendance" value="no" /><span data-i18n="att_no">Tidak dapat hadir</span></label>
              <label class="radio"><input type="radio" name="attendance" value="maybe" /><span data-i18n="att_maybe">Masih ragu</span></label>
            </div>
          </div>

          <div>
            <label data-i18n="f_guests">Jumlah orang</label>
            <select name="guests">
              <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option>
            </select>
          </div>

          <div>
            <label data-i18n="f_note">Catatan (opsional)</label>
            <textarea name="note" placeholder="Contoh: hadir 2 orang, dsb."></textarea>
          </div>

          <div>
            <label>Pesan / Ucapan</label>
            <textarea name="message" required placeholder="Tulis ucapan singkat..."></textarea>
          </div>

          <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
            <button class="btn ok" type="submit" data-i18n="btn_submit">Kirim RSVP</button>
            <button class="btn danger" type="button" id="btnReset" data-i18n="btn_reset">Reset</button>
            <span class="mutedText" id="saveInfo"></span>
          </div>
        </form>
      </div>
    </section>
  </div>

  <nav class="bottomNav" aria-label="Navigation">
    <a class="navItem active" href="#detail" data-nav="detail">
      <svg viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <span>Detail</span>
    </a>
    <a class="navItem" href="#kelas" data-nav="kelas">
      <svg viewBox="0 0 24 24" fill="none"><path d="M4 19V7l8-4 8 4v12l-8 4-8-4Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
      <span>Kelas</span>
    </a>
    <a class="navItem" href="#gallery" data-nav="gallery">
      <svg viewBox="0 0 24 24" fill="none"><path d="M4 7h16v12H4V7Z" stroke="currentColor" stroke-width="2"/><path d="M8 11l2 2 3-3 5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <span>Galeri</span>
    </a>
    <a class="navItem" href="#rsvp" data-nav="rsvp">
      <svg viewBox="0 0 24 24" fill="none"><path d="M7 12l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 12a8 8 0 1 1-16 0 8 8 0 0 1 16 0Z" stroke="currentColor" stroke-width="2"/></svg>
      <span>RSVP</span>
    </a>
  </nav>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <audio id="bgm" loop preload="none">
    <source src="./assets/bgm.mp3" type="audio/mpeg" />
  </audio>

  <script>
/***********************
 * CONFIG
 ***********************/
const CONFIG = {
  eventTitle: "RBM Japan Student Graduation Ceremony",
  startISO: "2026-01-24T13:00:00+09:00",
  endISO:   "2026-01-24T16:00:00+09:00",
  venueName: "十日市場地区センター",
  addressLine: "〒226-0025 神奈川県横浜市緑区十日市場町808-3",
  mapQuery: "十日市場地区センター",

  ENDPOINT: "https://script.google.com/macros/s/AKfycbwGA8_bsewf_rmdF4DbRQoT0pRR2dQ03DUHRwZIJP0K847smDncQWiNQzur9Cl34eKu/exec",

  coverImages: [
    "./assets/photos/01.jpg",
    "./assets/photos/02.jpg",
    "./assets/photos/03.jpg"
  ],

  autoGallery: {
    enabled: true,
    prefix: "./assets/photos/",
    start: 1,
    end: 50,
    pad: 2,
    ext: "jpg"
  },

  galleryImages: [
    "./assets/photos/01.jpg",
    "./assets/photos/02.jpg",
    "./assets/photos/03.jpg"
  ],

  classes: [
    { name: "Kelas Qur’an Darat", desc: "Program pembinaan tilawah dan pemahaman dasar." },
    { name: "Kelas Iqro’ Darat", desc: "Penguatan baca tulis Al-Qur’an (tahap Iqro’)." },
    { name: "Kelas PAI Semester 1", desc: "Materi PAI semester 1." },
    { name: "Kelas PAI Semester 2", desc: "Materi PAI semester 2." },
    { name: "Kelas Nuroniyah Kids", desc: "Kelas anak-anak (kids)." }
  ]
};

/***********************
 * i18n
 ***********************/
const I18N = {
  id: {
    top_title:"RBM Japan • Kelulusan",
    top_sub:"Undangan Web + RSVP",
    badge_event:"Acara Kelulusan",
    to_default:"Kepada Yth: Tamu Undangan",
    cover_title:"Undangan Kelulusan Siswa RBM Japan",
    cover_desc:"Klik tombol di bawah untuk membuka undangan dan mengisi daftar hadir/RSVP.",
    btn_open:"Buka Undangan",
    btn_share:"Bagikan",
    btn_map:"Buka Peta",
    btn_calendar:"Tambah ke Kalender",

    sec_detail:"Detail Acara",
    k_when:"Waktu", k_where:"Tempat", k_access:"Akses",
    access_text:"± 5–6 menit jalan kaki dari JR 横浜線 十日市場駅.",
    sec_countdown:"Hitung Mundur",
    cd_days:"Hari", cd_hours:"Jam", cd_mins:"Menit", cd_secs:"Detik",
    note_text:"Dress code rapi & sopan. Mohon hadir 15 menit lebih awal untuk registrasi.",

    sec_hadith:"Kutipan Hadits Shahih",
    hadith_tr:"“Barangsiapa menempuh jalan untuk mencari ilmu, maka Allah akan memudahkan baginya jalan menuju surga.”",
    hadith_src:"HR. Muslim (no. 2699) — potongan lafaz tentang menuntut ilmu.",

    sec_classes:"Kelas yang Diwisuda",
    classes_desc:"Berikut daftar kelas (bisa ditambah kapan saja).",

    sec_gallery:"Galeri",
    gallery_desc:"Taruh foto di folder assets/photos/ (01.jpg, 02.jpg, 03.jpg, dst).",

    sec_rsvp:"RSVP (Konfirmasi Kehadiran)",
    rsvp_hint:"Isi form di bawah.",
    men_notice_title:"Pengumuman:",
    men_notice_body:"Untuk Bapak-bapak, mohon menunggu di luar ruangan.",

    f_name:"Nama",
    f_contact:"Kontak (Email / WhatsApp)",
    f_attendance:"Kehadiran",
    att_yes:"Hadir", att_no:"Tidak dapat hadir", att_maybe:"Masih ragu",
    f_guests:"Jumlah orang",
    f_note:"Catatan (opsional)",
    btn_submit:"Kirim RSVP",
    btn_reset:"Reset",

    toast_share:"Link undangan disalin.",
    toast_music_on:"Musik: ON",
    toast_music_off:"Musik: OFF",
    toast_saved_local:"Tersimpan di perangkat.",
    toast_sent:"Terkirim.",
    toast_failed:"Tersimpan di perangkat. (Server belum merespons)"
  },
  en: {
    top_title:"RBM Japan • Graduation",
    top_sub:"Web Invitation + RSVP",
    badge_event:"Graduation Ceremony",
    to_default:"To: Invited Guest",
    cover_title:"RBM Japan Student Graduation Ceremony Invitation",
    cover_desc:"Let’s celebrate our students’ achievement. Tap below to open the invitation and submit your RSVP.",
    btn_open:"Open Invitation",
    btn_share:"Share",
    btn_map:"Open Map",
    btn_calendar:"Add to Calendar",

    sec_detail:"Event Details",
    k_when:"When", k_where:"Where", k_access:"Access",
    access_text:"Approx. 5–6 minutes walk from JR Yokohama Line Tokaichiba Station.",
    sec_countdown:"Countdown",
    cd_days:"Days", cd_hours:"Hours", cd_mins:"Minutes", cd_secs:"Seconds",
    note_text:"Dress neatly and respectfully. Please arrive 15 minutes early for registration.",

    sec_hadith:"Authentic Hadith Quote",
    hadith_tr:"“Whoever travels a path in search of knowledge, Allah will make easy for him a path to Paradise.”",
    hadith_src:"Sahih Muslim (no. 2699) — excerpt on seeking knowledge.",

    sec_classes:"Graduating Classes",
    classes_desc:"Class list (you can add more later).",

    sec_gallery:"Gallery",
    gallery_desc:"Put photos in assets/photos/ (01.jpg, 02.jpg, 03.jpg, ...).",

    sec_rsvp:"RSVP (Attendance Confirmation)",
    rsvp_hint:"Fill in the form.",
    men_notice_title:"Notice:",
    men_notice_body:"For fathers/men, please wait outside the room.",

    f_name:"Name",
    f_contact:"Contact (Email / WhatsApp)",
    f_attendance:"Attendance",
    att_yes:"Attending", att_no:"Not attending", att_maybe:"Maybe",
    f_guests:"Number of people",
    f_note:"Note (optional)",
    btn_submit:"Submit RSVP",
    btn_reset:"Reset",

    toast_share:"Invitation link copied.",
    toast_music_on:"Music: ON",
    toast_music_off:"Music: OFF",
    toast_saved_local:"Saved on your device.",
    toast_sent:"Sent.",
    toast_failed:"Saved on device. (Server not responding)"
  },
  ja: {
    top_title:"RBM Japan • 卒業式",
    top_sub:"Web招待状 + RSVP",
    badge_event:"卒業式",
    to_default:"ご招待：ゲスト様",
    cover_title:"RBM Japan 卒業式のご案内",
    cover_desc:"生徒の門出を一緒にお祝いしましょう。下のボタンから招待状を開き、出欠をご回答ください。",
    btn_open:"招待状を開く",
    btn_share:"共有",
    btn_map:"地図を開く",
    btn_calendar:"カレンダーに追加",

    sec_detail:"開催情報",
    k_when:"日時", k_where:"会場", k_access:"アクセス",
    access_text:"JR横浜線「十日市場駅」から徒歩約5〜6分。",
    sec_countdown:"カウントダウン",
    cd_days:"日", cd_hours:"時間", cd_mins:"分", cd_secs:"秒",
    note_text:"服装は清潔感のあるものを推奨します。受付のため15分前のご来場にご協力ください。",

    sec_hadith:"真正なハディースの引用",
    hadith_tr:"「知識を求めて道を歩む者には、アッラーが楽園への道を容易にして下さる」",
    hadith_src:"サヒーフ・ムスリム（2699）— 知識探求に関する一節。",

    sec_classes:"卒業クラス",
    classes_desc:"クラス一覧（追加可能）",

    sec_gallery:"ギャラリー",
    gallery_desc:"assets/photos/ に写真を入れてください（01.jpg, 02.jpg...）。",

    sec_rsvp:"RSVP（出欠回答）",
    rsvp_hint:"フォームにご入力ください。",
    men_notice_title:"お知らせ：",
    men_notice_body:"男性（お父様）は室外でお待ちください。",

    f_name:"お名前",
    f_contact:"連絡先（Email / WhatsApp）",
    f_attendance:"出欠",
    att_yes:"出席", att_no:"欠席", att_maybe:"未定",
    f_guests:"人数",
    f_note:"備考（任意）",
    btn_submit:"送信",
    btn_reset:"リセット",

    toast_share:"リンクをコピーしました。",
    toast_music_on:"音楽：ON",
    toast_music_off:"音楽：OFF",
    toast_saved_local:"端末に保存しました。",
    toast_sent:"送信しました。",
    toast_failed:"端末に保存しました。（サーバー未応答）"
  }
};

/***********************
 * Helpers
 ***********************/
const $ = (q)=>document.querySelector(q);
const $$ = (q)=>Array.from(document.querySelectorAll(q));
const state = { lang:"id", slideIndex:0, slideFlip:false, musicOn:false, opened:false };

function toast(msg){
  const t = $("#toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(toast._timer);
  toast._timer = setTimeout(()=>t.classList.remove("show"), 3200);
}

function pad2(n){ return String(n).padStart(2,"0"); }

function formatWhen(lang){
  const s = new Date(CONFIG.startISO);
  const e = new Date(CONFIG.endISO);
  const yyyy = s.getFullYear();
  const mm = s.getMonth()+1;
  const dd = s.getDate();
  const dow = s.getDay();
  const dowId = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"][dow];
  const dowEn = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][dow];
  const dowJa = ["日","月","火","水","木","金","土"][dow];
  const time = `${pad2(s.getHours())}:${pad2(s.getMinutes())}–${pad2(e.getHours())}:${pad2(e.getMinutes())} JST`;
  if(lang==="id") return `${dowId}, ${dd} Januari ${yyyy} • ${time}`;
  if(lang==="en") return `${dowEn}, January ${dd}, ${yyyy} • ${time}`;
  return `${yyyy}年${mm}月${dd}日（${dowJa}） • ${time}`;
}

function getQueryParam(name){
  const u = new URL(location.href);
  return u.searchParams.get(name);
}

function safeText(s){
  return String(s || "").replace(/[<>&"]/g, c => ({ "<":"&lt;", ">":"&gt;", "&":"&amp;", "\"":"&quot;" }[c]));
}

/***********************
 * Language
 ***********************/
function setLang(lang){
  state.lang = lang;
  document.documentElement.lang = lang;

  $$(".chip").forEach(c=>c.classList.toggle("active", c.dataset.lang===lang));

  $$("[data-i18n]").forEach(el=>{
    const key = el.getAttribute("data-i18n");
    if(I18N[lang] && I18N[lang][key] != null) el.textContent = I18N[lang][key];
  });

  $("#hadithTranslation").textContent = I18N[lang].hadith_tr;
  $("#hadithSource").textContent = I18N[lang].hadith_src;

  $("#whenText").textContent = formatWhen(lang);
  $("#addrText").textContent = CONFIG.addressLine;
  $("#btnMap").href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(CONFIG.mapQuery)}`;
}

/***********************
 * Cover slideshow (FIXED)
 ***********************/
function startSlides(){
  const a = $("#slideA");
  const b = $("#slideB");
  const imgs = (CONFIG.coverImages || []).filter(Boolean);
  if(imgs.length === 0) return;

  const setBg = (el, url)=> el.style.backgroundImage = `url("${url}")`;

  // start: A visible
  let current = a;
  let next = b;
  let idx = 0;

  setBg(current, imgs[idx]);
  current.classList.add("active");

  setBg(next, imgs[(idx+1) % imgs.length]);
  next.classList.remove("active");

  setInterval(()=>{
    idx = (idx + 1) % imgs.length;

    // prepare next
    setBg(next, imgs[idx]);
    next.classList.add("active");
    current.classList.remove("active");

    // swap refs
    const tmp = current;
    current = next;
    next = tmp;

  }, 5500);
}

/***********************
 * Countdown
 ***********************/
function startCountdown(){
  const target = new Date(CONFIG.startISO).getTime();
  function tick(){
    const now = Date.now();
    let diff = Math.max(0, target - now);

    const d = Math.floor(diff / (24*3600*1000)); diff -= d*24*3600*1000;
    const h = Math.floor(diff / (3600*1000)); diff -= h*3600*1000;
    const m = Math.floor(diff / (60*1000)); diff -= m*60*1000;
    const s = Math.floor(diff / 1000);

    $("#cdDays").textContent = d;
    $("#cdHours").textContent = pad2(h);
    $("#cdMins").textContent = pad2(m);
    $("#cdSecs").textContent = pad2(s);
  }
  tick();
  setInterval(tick, 1000);
}

/***********************
 * Calendar (.ics)
 ***********************/
function buildICS(){
  const dtStart = new Date(CONFIG.startISO);
  const dtEnd = new Date(CONFIG.endISO);
  const toICS = (d)=>{
    const u = new Date(d.getTime());
    const yyyy = u.getUTCFullYear();
    const mm = pad2(u.getUTCMonth()+1);
    const dd = pad2(u.getUTCDate());
    const hh = pad2(u.getUTCHours());
    const mi = pad2(u.getUTCMinutes());
    const ss = pad2(u.getUTCSeconds());
    return `${yyyy}${mm}${dd}T${hh}${mi}${ss}Z`;
  };
  const uid = `rbm-grad-${Date.now()}@rbm-japan`;
  return [
    "BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//RBM Japan//Graduation//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH",
    "BEGIN:VEVENT",
    `UID:${uid}`,
    `DTSTAMP:${toICS(new Date())}`,
    `DTSTART:${toICS(dtStart)}`,
    `DTEND:${toICS(dtEnd)}`,
    `SUMMARY:${CONFIG.eventTitle}`,
    `LOCATION:${CONFIG.venueName} (${CONFIG.addressLine})`,
    "DESCRIPTION:RBM Japan Graduation Ceremony",
    "END:VEVENT",
    "END:VCALENDAR"
  ].join("\r\n");
}

/***********************
 * Share
 ***********************/
async function shareLink(){
  const url = location.href;
  try{
    if(navigator.share){
      await navigator.share({ title: document.title, url });
      return;
    }
    await navigator.clipboard.writeText(url);
    toast(I18N[state.lang].toast_share);
  }catch{
    prompt("Copy link:", url);
  }
}

/***********************
 * Ripple
 ***********************/
function addRipple(e){
  const btn = e.currentTarget;
  const r = document.createElement("span");
  r.className = "ripple";
  const rect = btn.getBoundingClientRect();
  const x = (e.clientX || (rect.left + rect.width/2)) - rect.left;
  const y = (e.clientY || (rect.top + rect.height/2)) - rect.top;
  r.style.left = `${x}px`;
  r.style.top = `${y}px`;
  r.style.width = r.style.height = `${Math.max(rect.width, rect.height)}px`;
  btn.appendChild(r);
  setTimeout(()=>r.remove(), 600);
}

/***********************
 * Confetti
 ***********************/
function confettiBurst(durationMs=1500){
  const canvas = $("#confetti");
  const ctx = canvas.getContext("2d");
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  function resize(){
    canvas.width = Math.floor(innerWidth * dpr);
    canvas.height = Math.floor(innerHeight * dpr);
    canvas.style.width = innerWidth + "px";
    canvas.style.height = innerHeight + "px";
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  resize();
  window.addEventListener("resize", resize, { passive:true });

  const colors = ["#ffffff","#F6C453","#FF8A00","#1A56FF"];
  const parts = Array.from({length: 120}, ()=>({
    x: Math.random()*innerWidth,
    y: -20 - Math.random()*innerHeight*0.2,
    vx: (Math.random()*2-1)*3,
    vy: 3 + Math.random()*6,
    w: 4 + Math.random()*5,
    h: 6 + Math.random()*8,
    rot: Math.random()*Math.PI,
    vr: (Math.random()*2-1)*0.2,
    c: colors[Math.floor(Math.random()*colors.length)]
  }));

  const t0 = performance.now();
  function frame(t){
    const dt = (t - t0);
    ctx.clearRect(0,0,innerWidth,innerHeight);

    parts.forEach(p=>{
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.05;
      p.rot += p.vr;
      if(p.x < -30) p.x = innerWidth + 30;
      if(p.x > innerWidth + 30) p.x = -30;

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.c;
      ctx.globalAlpha = 0.95;
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    });

    if(dt < durationMs){
      requestAnimationFrame(frame);
    }else{
      ctx.clearRect(0,0,innerWidth,innerHeight);
      window.removeEventListener("resize", resize);
    }
  }
  requestAnimationFrame(frame);
}

/***********************
 * Reveal
 ***********************/
function initReveal(){
  const els = $$(".reveal");
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(en=>{
      if(en.isIntersecting) en.target.classList.add("show");
    });
  }, { threshold: 0.12 });
  els.forEach(el=>io.observe(el));
}

/***********************
 * Classes
 ***********************/
function renderClasses(){
  $("#classGrid").innerHTML = CONFIG.classes.map(c=>`
    <div class="classCard">
      <b>${safeText(c.name)}</b>
      <div class="small">${safeText(c.desc || "")}</div>
    </div>
  `).join("");
}

/***********************
 * Gallery Carousel (auto detect 01..N)
 ***********************/
let CAR = { imgs:[], idx:0, timer:null, dragging:false, startX:0, dx:0 };

function padN(n, pad){
  const s = String(n);
  return s.length >= pad ? s : "0".repeat(pad - s.length) + s;
}

async function loadImage(url){
  try{
    const res = await fetch(url, { method:"HEAD", cache:"no-cache" });
    return { ok: res.ok, url };
  }catch{
    return { ok:false, url };
  }
}

async function discoverGalleryImages(){
  if(CONFIG.autoGallery && CONFIG.autoGallery.enabled){
    const { prefix, start, end, pad, ext } = CONFIG.autoGallery;
    const candidates = [];
    for(let i=start; i<=end; i++){
      candidates.push(prefix + padN(i, pad) + "." + ext);
    }
    const results = await Promise.all(candidates.map(loadImage));
    const found = results.filter(r=>r.ok).map(r=>r.url);
    if(found.length) return found;
  }
  return (CONFIG.galleryImages || []).filter(Boolean);
}

function buildDots(){
  const dots = $("#carouselDots");
  dots.innerHTML = CAR.imgs.map((_, i)=>`<span class="dot ${i===CAR.idx?"active":""}" data-i="${i}"></span>`).join("");
  $$("#carouselDots .dot").forEach(d=>{
    d.addEventListener("click", ()=>{
      goToSlide(parseInt(d.dataset.i,10));
      restartAutoplay();
    });
  });
}

function updateCarousel(){
  const track = $("#carouselTrack");
  const w = $("#galleryCarousel").clientWidth;
  track.style.transform = `translateX(${-(CAR.idx*w)}px)`;
  $$("#carouselDots .dot").forEach((d,i)=> d.classList.toggle("active", i===CAR.idx));
}

function goToSlide(i){
  if(!CAR.imgs.length) return;
  CAR.idx = (i + CAR.imgs.length) % CAR.imgs.length;
  updateCarousel();
}
function nextSlide(){ goToSlide(CAR.idx + 1); }
function prevSlide(){ goToSlide(CAR.idx - 1); }

function startAutoplay(){
  stopAutoplay();
  CAR.timer = setInterval(nextSlide, 4200);
}
function stopAutoplay(){
  if(CAR.timer){ clearInterval(CAR.timer); CAR.timer = null; }
}
function restartAutoplay(){ stopAutoplay(); startAutoplay(); }

async function renderGallery(){
  const track = $("#carouselTrack");
  track.innerHTML = `<div class="mutedText" style="padding:12px;">Loading...</div>`;

  const imgs = await discoverGalleryImages();
  CAR.imgs = imgs;
  CAR.idx = 0;

  if(!imgs.length){
    track.innerHTML = `<div class="mutedText" style="padding:12px;">Belum ada foto.</div>`;
    $("#carouselDots").innerHTML = "";
    return;
  }

  track.innerHTML = imgs.map((src, idx)=>`
    <div class="carouselItem" data-src="${safeText(src)}" data-idx="${idx}">
      <img src="${safeText(src)}" alt="photo ${idx+1}">
    </div>
  `).join("");

  $$("#carouselTrack .carouselItem").forEach(el=>{
    el.addEventListener("click", ()=>{
      $("#lightboxImg").src = el.dataset.src;
      $("#lightbox").classList.add("show");
      $("#lightbox").setAttribute("aria-hidden","false");
      stopAutoplay();
    });
  });

  buildDots();
  updateCarousel();
  startAutoplay();

  $("#carNext").onclick = ()=>{ nextSlide(); restartAutoplay(); };
  $("#carPrev").onclick = ()=>{ prevSlide(); restartAutoplay(); };

  const car = $("#galleryCarousel");
  car.addEventListener("pointerdown", (e)=>{
    CAR.dragging = true;
    CAR.startX = e.clientX;
    CAR.dx = 0;
    stopAutoplay();
    car.setPointerCapture(e.pointerId);
  });
  car.addEventListener("pointermove", (e)=>{
    if(!CAR.dragging) return;
    CAR.dx = e.clientX - CAR.startX;
    const w = car.clientWidth;
    const track = $("#carouselTrack");
    track.style.transition = "none";
    track.style.transform = `translateX(${-(CAR.idx*w) + CAR.dx}px)`;
  });
  function endDrag(){
    if(!CAR.dragging) return;
    CAR.dragging = false;
    const w = car.clientWidth;
    const track = $("#carouselTrack");
    track.style.transition = "";
    const threshold = Math.min(80, w * 0.18);
    if(CAR.dx > threshold) prevSlide();
    else if(CAR.dx < -threshold) nextSlide();
    updateCarousel();
    restartAutoplay();
  }
  car.addEventListener("pointerup", endDrag);
  car.addEventListener("pointercancel", endDrag);

  window.addEventListener("resize", ()=>updateCarousel(), { passive:true });
}

/***********************
 * Lightbox close
 ***********************/
$("#lightbox").addEventListener("click", ()=>{
  $("#lightbox").classList.remove("show");
  $("#lightbox").setAttribute("aria-hidden","true");
  $("#lightboxImg").src = "";
  restartAutoplay();
});

/***********************
 * Music
 ***********************/
async function toggleMusic(){
  const audio = $("#bgm");
  try{
    if(!state.musicOn){
      await audio.play();
      state.musicOn = true;
      toast(I18N[state.lang].toast_music_on);
    }else{
      audio.pause();
      state.musicOn = false;
      toast(I18N[state.lang].toast_music_off);
    }
  }catch{
    toast("Musik tidak bisa diputar (cek assets/bgm.mp3).");
  }
}
$("#btnMusic").addEventListener("click", toggleMusic);

/***********************
 * Bottom nav active
 ***********************/
function initBottomNav(){
  const items = $$(".navItem");
  const sections = items.map(i => document.getElementById(i.getAttribute("href").slice(1))).filter(Boolean);

  const io = new IntersectionObserver((entries)=>{
    let best = null;
    for(const e of entries){
      if(e.isIntersecting){
        if(!best || e.intersectionRatio > best.intersectionRatio) best = e;
      }
    }
    if(best){
      const id = best.target.id;
      items.forEach(it=>it.classList.toggle("active", it.getAttribute("href")==="#"+id));
    }
  }, { threshold: [0.2, 0.35, 0.5, 0.65] });

  sections.forEach(s=>io.observe(s));
}

/***********************
 * Local + endpoint (RSVP)
 ***********************/
const KEY_RSVP = "rbm_rsvp_latest_v1";

async function postToEndpoint(payload){
  if(!CONFIG.ENDPOINT) return { ok:false, reason:"no-endpoint" };

  const params = new URLSearchParams();
  for(const [k,v] of Object.entries(payload)){
    if(v == null) continue;
    if(typeof v === "object") params.set(k, JSON.stringify(v));
    else params.set(k, String(v));
  }

  try{
    if(navigator.sendBeacon){
      const blob = new Blob([params.toString()], { type:"application/x-www-form-urlencoded;charset=UTF-8" });
      const ok = navigator.sendBeacon(CONFIG.ENDPOINT, blob);
      return { ok, via:"beacon" };
    }
  }catch{}

  try{
    await fetch(CONFIG.ENDPOINT, {
      method: "POST",
      mode: "no-cors",
      body: params
    });
    return { ok:true, via:"no-cors" };
  }catch(e){
    return { ok:false, reason:String(e) };
  }
}

$("#rsvpForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);

  const payload = {
    type: "rsvp",
    name: String(fd.get("name")||"").trim(),
    contact: String(fd.get("contact")||"").trim(),
    attendance: String(fd.get("attendance")||""),
    guests: String(fd.get("guests")||"1"),
    lang: state.lang,

    message: String(fd.get("message")||"").trim(),
    note: String(fd.get("note")||"").trim(),
    ts: new Date().toISOString(),
    page: location.href,
    eventTitle: CONFIG.eventTitle,
    startISO: CONFIG.startISO,
    venue: CONFIG.venueName
  };

  localStorage.setItem(KEY_RSVP, JSON.stringify(payload));
  $("#saveInfo").textContent = I18N[state.lang].toast_saved_local;

  if(CONFIG.ENDPOINT){
    const res = await postToEndpoint(payload);
    if(res && res.ok){
      toast(I18N[state.lang].toast_sent);
    }else{
      toast(I18N[state.lang].toast_failed);
    }
  }else{
    toast(I18N[state.lang].toast_saved_local);
  }

  e.target.reset();
});

$("#btnReset").addEventListener("click", ()=>{
  $("#rsvpForm").reset();
  $("#saveInfo").textContent = "";
});

/***********************
 * Cover open flow
 ***********************/
function openInvitation(){
  if(state.opened) return;
  state.opened = true;

  document.body.classList.add("opened");
  confettiBurst(1400);

  setTimeout(()=> document.getElementById("detail").scrollIntoView({behavior:"smooth", block:"start"}), 180);
}

$("#btnOpen").addEventListener("click", (e)=>{ addRipple(e); openInvitation(); });
$("#btnShare").addEventListener("click", (e)=>{ addRipple(e); shareLink(); });
$("#btnCalendar").addEventListener("click", (e)=>{
  addRipple(e);
  const ics = buildICS();
  const blob = new Blob([ics], { type:"text/calendar;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "RBM-Japan-Graduation.ics";
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 800);
});

/***********************
 * Language controls
 ***********************/
$$(".chip").forEach(ch => ch.addEventListener("click", ()=> setLang(ch.dataset.lang)));

/***********************
 * Personalization ?to=
 ***********************/
const to = getQueryParam("to");
if(to){
  const name = decodeURIComponent(to);
  const t = $("#toLine");
  t.textContent = `Kepada Yth: ${name}`;
  const rsvpName = document.querySelector('#rsvpForm input[name="name"]');
  if(rsvpName && !rsvpName.value) rsvpName.value = name;
}

/***********************
 * Init
 ***********************/
setLang("id");
$("#addrText").textContent = CONFIG.addressLine;
$("#btnMap").href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(CONFIG.mapQuery)}`;

renderClasses();
renderGallery();
startSlides();
startCountdown();
initReveal();
initBottomNav();
  </script>
</body>
</html>
