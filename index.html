<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#1A56FF" />
  <title>RBM Japan • Graduation</title>

  <link rel="icon" href="data:,">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700;800&family=Noto+Sans+JP:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet">

  <style>
:root{
  --sky1:#BFEFFF;
  --sky2:#EAFBFF;

  --accent:#00B7FF;
  --accent2:#2D7DFF;

  --text:#08324A;
  --muted: rgba(8,50,74,.72);

  --cardBg: rgba(255,255,255,.86);
  --shadow: 0 18px 55px rgba(0,60,120,.14);
  --shadow2: 0 14px 40px rgba(0,60,120,.10);

  --r: 22px;
  --tap: 46px;

  --emerald:#16A34A;      /* nuansa islami */
  --gold:#F6C453;         /* nuansa wisuda */
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family:"Noto Sans","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color: var(--text);
  overflow-x:hidden;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  font-size: 16px;

  background:
    radial-gradient(900px 600px at 15% 15%, rgba(255,255,255,.95), transparent 60%),
    radial-gradient(900px 600px at 85% 25%, rgba(134,215,255,.55), transparent 60%),
    radial-gradient(900px 600px at 20% 85%, rgba(191,239,255,.62), transparent 65%),
    linear-gradient(140deg, var(--sky1), var(--sky2));

  background-size: 160% 160%;
  animation: bgShiftKids 10s ease-in-out infinite alternate;
}
@keyframes bgShiftKids{
  0%{ background-position: 0% 40%; filter:saturate(1.10) brightness(1.06); }
  100%{ background-position: 100% 65%; filter:saturate(1.14) brightness(1.08); }
}

body:not(.opened){ overflow: hidden; }

a{ color:inherit; }
.container{
  max-width: 980px;
  margin: 0 auto;
  padding: 16px 14px calc(92px + env(safe-area-inset-bottom));
}

/* sparkles */
body::before,
body::after{
  content:"";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
}
body::before{
  background:
    radial-gradient(circle at 10% 20%, rgba(255,255,255,.70) 0 2px, transparent 3px),
    radial-gradient(circle at 35% 40%, rgba(255,255,255,.55) 0 2px, transparent 3px),
    radial-gradient(circle at 60% 25%, rgba(255,255,255,.60) 0 2px, transparent 3px),
    radial-gradient(circle at 80% 55%, rgba(255,255,255,.50) 0 2px, transparent 3px),
    radial-gradient(circle at 20% 75%, rgba(255,255,255,.55) 0 2px, transparent 3px);
  opacity: .18;
  animation: sparkleDrift 14s linear infinite;
}
body::after{
  background:
    radial-gradient(circle at 15% 30%, rgba(0,183,255,.28) 0 2px, transparent 3px),
    radial-gradient(circle at 70% 35%, rgba(45,125,255,.20) 0 2px, transparent 3px),
    radial-gradient(circle at 85% 80%, rgba(134,215,255,.24) 0 2px, transparent 3px);
  opacity: .12;
  animation: sparkleDrift2 18s linear infinite;
}
@keyframes sparkleDrift{ 100%{ transform: translate3d(-4vw, 6vh, 0); } }
@keyframes sparkleDrift2{ 100%{ transform: translate3d(5vw, -5vh, 0); } }

/* subtle islamic pattern */
.islamicPattern{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: .08;
  mix-blend-mode: soft-light;
  background:
    radial-gradient(circle at 20% 30%, rgba(246,196,83,.30), transparent 55%),
    radial-gradient(circle at 80% 70%, rgba(22,163,74,.18), transparent 60%),
    repeating-radial-gradient(circle at 50% 50%,
      rgba(0,183,255,.10) 0 2px,
      transparent 2px 22px);
}

/* bubbles */
.bubbles{
  position: fixed;
  inset: 0;
  pointer-events:none;
  overflow:hidden;
  z-index: 0;
}
.bubble{
  position:absolute;
  width: 22vmin;
  height: 22vmin;
  border-radius: 999px;
  opacity:.18;
  border: 1px solid rgba(255,255,255,.38);
  animation: floatUp 12s linear infinite;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.78), rgba(255,255,255,.10));
  box-shadow: 0 18px 55px rgba(0,60,120,.10);
}
@keyframes floatUp{
  0%{ transform: translate3d(0, 110vh, 0) scale(.85); }
  100%{ transform: translate3d(10vw, -30vh, 0) scale(1.12); }
}

/* stickers */
.stickers{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 1;
  overflow: hidden;
}
.sticker{
  position: absolute;
  top: -120px;
  width: var(--s, 72px);
  height: var(--s, 72px);
  opacity: var(--o, .16);
  filter: drop-shadow(0 12px 24px rgba(0,60,120,.10));
  animation: stickerFloat var(--t, 16s) ease-in-out infinite;
}
.sticker.cloud{
  background:
    radial-gradient(circle at 32% 58%, rgba(255,255,255,.95) 0 22%, transparent 24%),
    radial-gradient(circle at 52% 44%, rgba(255,255,255,.95) 0 28%, transparent 30%),
    radial-gradient(circle at 72% 58%, rgba(255,255,255,.95) 0 20%, transparent 22%),
    radial-gradient(60% 55% at 52% 70%, rgba(255,255,255,.95) 0 55%, transparent 57%);
  border-radius: 999px;
}
.sticker.star{
  background: rgba(0,183,255,.18);
  clip-path: polygon(
    50% 0%,
    62% 34%,
    98% 35%,
    69% 57%,
    80% 92%,
    50% 72%,
    20% 92%,
    31% 57%,
    2% 35%,
    38% 34%
  );
}
.sticker.star.soft{ background: rgba(45,125,255,.14); }
.sticker.crescent{
  border-radius: 999px;
  background:
    radial-gradient(circle at 38% 50%, rgba(255,255,255,.92) 0 54%, transparent 55%),
    radial-gradient(circle at 58% 50%, transparent 0 46%, rgba(255,255,255,.92) 47% 100%);
}
@keyframes stickerFloat{
  0%   { transform: translate3d(var(--x,0px), 110vh, 0) rotate(0deg) scale(.98); }
  50%  { transform: translate3d(calc(var(--x,0px) + 10px), 48vh, 0) rotate(8deg) scale(1.03); }
  100% { transform: translate3d(calc(var(--x,0px) - 10px), -25vh, 0) rotate(-6deg) scale(.99); }
}

/* Top bar */
.topbar{
  position: sticky; top: 0; z-index: 20;
  backdrop-filter: blur(12px);
  background: rgba(255,255,255,.72);
  border-bottom: 1px solid rgba(0,183,255,.18);
}
.topbar-inner{
  max-width: 980px; margin:0 auto;
  padding: 10px 14px;
  display:flex; align-items:center; justify-content:space-between; gap: 10px;
}
.brand{ display:flex; align-items:center; gap:10px; min-width: 240px; }
.logo{
  width: 44px; height: 44px;
  border-radius: 16px;
  overflow:hidden;
  background: rgba(255,255,255,.85);
  border: 1px solid rgba(0,183,255,.18);
  box-shadow: var(--shadow2);
}
.logo img{ width:100%; height:100%; object-fit:cover; display:block; }
.brand h1{ margin:0; font-size:14px; font-weight:900; line-height:1.1; }
.brand p{ margin:2px 0 0; font-size:12px; color: var(--muted); }

.right{ display:flex; align-items:center; gap:8px; }

.chip{
  height: 34px;
  padding: 0 10px;
  border-radius: 999px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.70);
  color: rgba(8,50,74,.90);
  display:inline-flex; align-items:center; justify-content:center;
  font-size: 12px;
  cursor: pointer;
  user-select:none;
  transition: transform .12s ease, background .2s ease;
}
.chip:active{ transform: scale(.98); }
.chip.active{
  background: linear-gradient(90deg, rgba(0,183,255,.95), rgba(45,125,255,.92));
  border-color: rgba(0,183,255,.22);
  color: #fff;
}
.iconBtn{
  width: 38px; height: 38px;
  border-radius: 14px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.70);
  color: rgba(8,50,74,.95);
  display:grid; place-items:center;
  cursor:pointer; user-select:none;
  transition: transform .12s ease, background .2s ease;
}
.iconBtn:active{ transform: scale(.98); }
.iconBtn:hover{ background: rgba(255,255,255,.85); }
.iconBtn.active{
  background: linear-gradient(90deg, rgba(255,183,3,.92), rgba(255,0,110,.72));
  border-color: rgba(255,183,3,.28);
  color: #fff;
  box-shadow: 0 12px 30px rgba(255,0,110,.14);
}

/* Cover */
.coverWrap{
  position: fixed;
  inset: 0;
  z-index: 50;
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 18px 14px;
  background: rgba(8,50,74,.14);
  backdrop-filter: blur(12px);
  transition: opacity .55s ease, transform .55s ease;
}
body.opened .coverWrap{
  opacity: 0;
  transform: translateY(-10px);
  pointer-events:none;
}

.coverCard{
  width: min(980px, 100%);
  border-radius: 28px;
  overflow:hidden;
  border: 1px solid rgba(0,183,255,.18);
  box-shadow: var(--shadow);
  background: rgba(255,255,255,.92);
  position:relative;
  transform: translateY(8px);
  animation: popIn .7s ease both;
}
@keyframes popIn{
  from{ opacity:0; transform: translateY(18px) scale(.98); }
  to{ opacity:1; transform: translateY(0) scale(1); }
}

/* light ribbon + laurel (wisuda) */
.coverCard::before{
  content:"";
  position:absolute;
  left: 18px;
  right: 18px;
  top: 12px;
  height: 10px;
  border-radius: 999px;
  background: linear-gradient(90deg,
    rgba(246,196,83,.0),
    rgba(246,196,83,.60),
    rgba(0,183,255,.28),
    rgba(246,196,83,.60),
    rgba(246,196,83,.0)
  );
  pointer-events:none;
  z-index: 0;
}
.coverCard::after{
  content:"";
  position:absolute;
  inset: 14px;
  border-radius: 26px;
  pointer-events:none;
  z-index: 0;
  background:
    radial-gradient(circle at 12% 42%, rgba(246,196,83,.24) 0 2px, transparent 3px),
    radial-gradient(circle at 88% 42%, rgba(246,196,83,.24) 0 2px, transparent 3px),
    linear-gradient(180deg, rgba(246,196,83,.10), rgba(246,196,83,0));
  opacity: .65;
}

.coverMedia{
  height: 360px;
  position:relative;
  background:#cfefff;
  z-index: 1;
}
.slide{
  position:absolute; inset:0;
  background-size: cover;
  background-position:center;
  transform: scale(1.08);
  opacity:0;
  transition: opacity 1.1s ease;
  animation: kenburns 16s ease-in-out infinite;
  filter: saturate(1.04) contrast(1.02);
}
.slide.active{ opacity:1; }
@keyframes kenburns{
  0%{ transform: scale(1.08) translate3d(0,0,0); }
  50%{ transform: scale(1.16) translate3d(-1.6%, -1.1%, 0); }
  100%{ transform: scale(1.08) translate3d(0,0,0); }
}
/* overlay: cukup, tidak bikin foto pudar */
.coverMedia::after{
  content:"";
  position:absolute; inset:0;
  background: linear-gradient(180deg,
    rgba(255,255,255,0) 0%,
    rgba(255,255,255,.52) 62%,
    rgba(255,255,255,.92) 100%
  );
}

.coverBody{ position:relative; padding: 18px 16px 16px; z-index: 2; }
.badgeRow{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
.badge{
  font-size: 12px;
  padding: 7px 10px;
  border-radius: 999px;
  border: 1px solid rgba(246,196,83,.32);
  background: rgba(255,255,255,.78);
  color: rgba(8,50,74,.90);
  box-shadow: 0 10px 24px rgba(246,196,83,.08);
}
.toLine{ margin-top: 10px; font-size: 12px; color: var(--muted); }

/* Title + icon (wisuda) */
.coverTitle{
  margin: 6px 0 8px;
  font-size: clamp(22px, 4.5vw, 40px);
  line-height: 1.12;
  font-weight: 950;
  letter-spacing:.2px;
  color: var(--text);
  position: relative;
  padding-left: 44px;
}
.coverTitle::before{
  content:"";
  position:absolute;
  left: 0;
  top: .18em;
  width: 34px;
  height: 34px;
  opacity: .95;
  background-size: 34px 34px;
  background-repeat:no-repeat;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'%3E%3Cpath d='M4 24L32 12l28 12-28 12L4 24Z' fill='%2300B7FF'/%3E%3Cpath d='M16 30v10c0 8 32 8 32 0V30l-16 7-16-7Z' fill='%2316A34A'/%3E%3Cpath d='M52 26v16' stroke='%23F6C453' stroke-width='4' stroke-linecap='round'/%3E%3Ccircle cx='52' cy='46' r='4' fill='%23F6C453'/%3E%3C/svg%3E");
}

.coverDesc{
  margin: 0;
  color: rgba(8,50,74,.80);
  font-size: 14px;
  line-height: 1.7;
  max-width: 72ch;
}

/* Doa line (HTML i18n) */
.duaLine{
  margin-top: 6px;
  font-size: 12px;
  line-height: 1.6;
  color: rgba(8,50,74,.78);
  display: inline-flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
}
.duaLine::before{
  content:"";
  width: 10px;
  height: 10px;
  border-radius: 999px;
  background: rgba(246,196,83,.70);
  box-shadow: 0 0 0 3px rgba(246,196,83,.18);
}
.duaAr{
  font-family: "Noto Naskh Arabic","Noto Sans","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  font-weight: 700;
  direction: rtl;
}
.duaSep{ opacity:.7; }
.duaLt{ color: rgba(8,50,74,.78); }

/* Buttons + ripple */
.btnRow{
  margin-top: 14px;
  display:flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items:center;
}

.btn{
  min-height: var(--tap);
  padding: 0 14px;
  border-radius: 16px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.82);
  color: rgba(8,50,74,.92);
  font-weight: 900;
  font-size: 13px;
  cursor:pointer;
  user-select:none;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 10px;
  position:relative;
  overflow:hidden;
  transition: transform .12s ease, background .2s ease, box-shadow .2s ease;
  box-shadow: 0 10px 26px rgba(0,60,120,.08);
  text-decoration:none;
}
.btn:hover{ background: rgba(255,255,255,.95); }
.btn:active{ transform: scale(.99); }

.btn.primary{
  background: linear-gradient(90deg, rgba(22,163,74,.92), rgba(0,183,255,.98), rgba(45,125,255,.94));
  border-color: rgba(0,183,255,.22);
  color: #fff;
  box-shadow: 0 14px 34px rgba(0,60,120,.14);
  animation: btnGlow 2.6s ease-in-out infinite alternate;
}
@keyframes btnGlow{
  0%{ transform: translateY(0); filter: brightness(1); }
  100%{ transform: translateY(-1px); filter: brightness(1.05); }
}
.btn.ok{
  background: rgba(16,185,129,.12);
  border-color: rgba(16,185,129,.22);
  color: rgba(8,50,74,.92);
}
.btn.danger{
  background: rgba(244,63,94,.10);
  border-color: rgba(244,63,94,.20);
  color: rgba(8,50,74,.92);
}

.ripple{
  position:absolute;
  border-radius: 999px;
  transform: scale(0);
  animation: ripple .55s ease-out;
  background: rgba(255,255,255,.70);
  pointer-events:none;
  mix-blend-mode: overlay;
}
@keyframes ripple{ to{ transform: scale(6); opacity:0; } }

/* Cards */
.section{ margin-top: 14px; position:relative; z-index: 5; }
.card{
  position: relative;
  z-index: 5;
  border-radius: var(--r);
  border: 1px solid transparent;
  overflow:hidden;
  background:
    linear-gradient(var(--cardBg), var(--cardBg)) padding-box,
    linear-gradient(90deg,
      rgba(22,163,74,.34),
      rgba(0,183,255,.55),
      rgba(246,196,83,.30)
    ) border-box;
  background-size: 100% 100%, 220% 220%;
  background-position: 0 0, 0% 50%;
  animation: cardBorderShimmer 7s ease-in-out infinite alternate;
  box-shadow: var(--shadow);
}
@keyframes cardBorderShimmer{
  0%   { background-position: 0 0, 0% 50%; }
  100% { background-position: 0 0, 100% 50%; }
}
.cardBody{ padding: 16px; }
.card h2{
  margin:0 0 10px;
  font-size: 15px;
  font-weight: 950;
  letter-spacing:.2px;
  color: rgba(8,50,74,.98);
}

.mutedText{ color: var(--muted); font-size: 12px; line-height: 1.6; }
.hr{ height:1px; background: rgba(0,183,255,.18); margin: 12px 0; }
.notice{
  border-radius: 18px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.78);
  padding: 12px 12px;
  color: rgba(8,50,74,.92);
  font-size: 13px;
  line-height: 1.6;
}
.notice b{ font-weight: 950; }

.grid{ display:grid; grid-template-columns: 1.2fr .8fr; gap: 14px; }
@media (max-width: 900px){ .grid{ grid-template-columns: 1fr; } }

.kv{
  display:grid;
  grid-template-columns: 140px 1fr;
  gap: 8px 12px;
  font-size: 13px;
  align-items:start;
  color: rgba(8,50,74,.92);
}
@media (max-width: 520px){
  .kv{ grid-template-columns: 1fr; font-size: 14px; }
  .mutedText{ font-size: 13px; }
}

/* Countdown */
.countdown{
  display:grid;
  grid-template-columns: repeat(4,1fr);
  gap: 10px;
  margin-top: 8px;
}
.cdBox{
  text-align:center;
  padding: 10px 8px;
  border-radius: 18px;
  border:1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.78);
}
.cdNum{ font-size: 20px; font-weight: 950; }
.cdLbl{ font-size: 11px; color: var(--muted); margin-top:4px; }

/* Hadith */
.arabic{
  font-family: "Noto Naskh Arabic","Noto Sans","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  font-size: 18px;
  line-height: 1.9;
  direction: rtl;
  text-align:right;
  padding: 10px 12px;
  border-radius: 18px;
  background: rgba(0,183,255,.10);
  border: 1px solid rgba(0,183,255,.18);
  margin: 8px 0 10px;
  color: rgba(8,50,74,.95);
}
.quote{ font-size:13px; line-height:1.7; color: rgba(8,50,74,.90); }
.source{ font-size:12px; color: var(--muted); margin-top:10px; }

/* Classes */
.classGrid{ display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
@media (max-width: 900px){ .classGrid{ grid-template-columns: repeat(2,1fr); } }
@media (max-width: 520px){ .classGrid{ grid-template-columns: 1fr; } }
.classCard{
  border:1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.78);
  border-radius: 18px;
  padding: 12px;
}
.classCard b{ display:block; font-weight: 950; }
.classCard .small{ font-size:12px; color: var(--muted); margin-top:6px; line-height:1.6; }

/* Carousel */
.carousel{
  position: relative;
  overflow: hidden;
  border-radius: 22px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.72);
}
.carouselTrack{
  display: flex;
  transition: transform .55s cubic-bezier(.2,.9,.2,1);
  will-change: transform;
}
.carouselItem{ min-width: 100%; aspect-ratio: 16 / 10; position: relative; user-select: none; }
@media (max-width: 520px){ .carouselItem{ aspect-ratio: 16 / 12; } }
.carouselItem img{ width: 100%; height: 100%; object-fit: cover; display: block; transform: scale(1.02); }
.carouselCtrl{
  position:absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 3;
  width: 44px;
  height: 44px;
  border-radius: 16px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.78);
  color: rgba(8,50,74,.95);
  display:grid;
  place-items:center;
  cursor:pointer;
  user-select:none;
}
.carouselCtrl:active{ transform: translateY(-50%) scale(.98); }
.carouselCtrl.prev{ left: 10px; }
.carouselCtrl.next{ right: 10px; }

.carouselDots{
  position:absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: 10px;
  display:flex;
  gap: 6px;
  z-index: 3;
  padding: 6px 8px;
  border-radius: 999px;
  background: rgba(255,255,255,.72);
  border: 1px solid rgba(0,183,255,.18);
  backdrop-filter: blur(10px);
}
.dot{ width: 7px; height: 7px; border-radius: 999px; background: rgba(8,50,74,.25); cursor:pointer; }
.dot.active{ background: rgba(8,50,74,.70); }

/* Lightbox */
.lightbox{
  position:fixed; inset:0; z-index: 70;
  background: rgba(8,50,74,.62);
  display:none;
  align-items:center; justify-content:center;
  padding: 18px;
}
.lightbox.show{ display:flex; }
.lightbox img{
  max-width: min(980px, 94vw);
  max-height: 84vh;
  border-radius: 22px;
  border:1px solid rgba(0,183,255,.18);
  box-shadow: var(--shadow);
  background:#fff;
}

/* Forms */
form{ display:grid; gap:10px; }
label{ font-size:12px; color: rgba(8,50,74,.90); }
input, select, textarea{
  width:100%;
  min-height: var(--tap);
  padding: 10px 12px;
  border-radius: 16px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.88);
  color: rgba(8,50,74,.92);
  outline:none;
  box-shadow: 0 10px 22px rgba(0,60,120,.06);
}
input:focus, select:focus, textarea:focus{
  border-color: rgba(0,183,255,.40);
  box-shadow: 0 0 0 3px rgba(0,183,255,.16), 0 10px 22px rgba(0,60,120,.06);
}
textarea{ min-height: 92px; resize: vertical; }
.row2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
@media (max-width: 520px){ .row2{ grid-template-columns: 1fr; } }

.radioRow{ display:flex; flex-wrap:wrap; gap:10px; }
.radio{
  min-height: var(--tap);
  display:flex; gap:8px; align-items:center;
  padding: 10px 12px;
  border-radius: 16px;
  border: 1px solid rgba(0,183,255,.18);
  background: rgba(255,255,255,.80);
  cursor:pointer;
  user-select:none;
  font-size: 13px;
  color: rgba(8,50,74,.90);
}
.radio input{ width:auto; }

/* Reveal */
.reveal{
  opacity: 0;
  transform: translateY(14px) scale(.995);
  transition: opacity .65s ease, transform .65s cubic-bezier(.2,.9,.2,1);
}
.reveal.show{ opacity: 1; transform: translateY(0) scale(1); }

/* Bottom nav */
.bottomNav{
  position: fixed;
  left: 50%;
  bottom: calc(10px + env(safe-area-inset-bottom));
  transform: translateX(-50%);
  z-index: 25;
  width: min(520px, calc(100vw - 18px));
  border-radius: 22px;
  background: rgba(255,255,255,.76);
  border: 1px solid rgba(0,183,255,.18);
  backdrop-filter: blur(12px);
  box-shadow: var(--shadow);
  display:flex;
  justify-content:space-between;
  padding: 8px;
  gap: 6px;
}
.navItem{
  flex:1;
  min-height: 44px;
  border-radius: 16px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap: 4px;
  font-size: 10px;
  color: rgba(8,50,74,.82);
  text-decoration:none;
  border: 1px solid transparent;
}
.navItem.active{
  background: rgba(0,183,255,.12);
  border-color: rgba(0,183,255,.18);
}
.navItem svg{ width: 18px; height: 18px; opacity:.95; }

/* Toast */
.toast{
  position: fixed;
  right: 14px;
  bottom: calc(90px + env(safe-area-inset-bottom));
  z-index: 90;
  background: rgba(255,255,255,.86);
  border: 1px solid rgba(0,183,255,.18);
  border-radius: 18px;
  padding: 12px 12px;
  box-shadow: var(--shadow);
  max-width: 420px;
  display:none;
  backdrop-filter: blur(12px);
  color: rgba(8,50,74,.92);
}
.toast.show{ display:block; }

/* KAIZEN: Full-colour kids background FX (stars/lanterns/confetti — no faces) */
#kidsFx{
  position: fixed;
  inset: 0;
  pointer-events:none;
  z-index: 2;
  opacity: .86;               /* lebih kelihatan (full colour) */
  mix-blend-mode: normal;     /* paling kompatibel */
  filter: saturate(1.18) contrast(1.08);
}
body.opened #kidsFx{ opacity: .92; } /* lebih meriah setelah dibuka */

/* KAIZEN: Rainbow aura khusus untuk section Kelas (lebih “hidup”) */
#kelas{
  isolation: isolate;
}
#kelas::before{
  content:"";
  position:absolute;
  inset:-90px;
  pointer-events:none;
  z-index: 0;
  opacity: .34;
  filter: blur(22px);
  transform: translate3d(0,0,0);
  background:
    radial-gradient(circle at 12% 18%, rgba(255,0,110,.32), transparent 48%),
    radial-gradient(circle at 88% 22%, rgba(58,134,255,.30), transparent 52%),
    radial-gradient(circle at 78% 88%, rgba(6,214,160,.26), transparent 56%),
    radial-gradient(circle at 22% 86%, rgba(255,183,3,.26), transparent 55%),
    conic-gradient(from 90deg,
      rgba(255,183,3,.22),
      rgba(131,56,236,.20),
      rgba(255,94,94,.22),
      rgba(0,183,255,.18),
      rgba(255,183,3,.22)
    );
  animation: kelasAuraSpin 10s linear infinite;
}
#kelas .cardBody{ position:relative; z-index: 1; }

@keyframes kelasAuraSpin{
  0%{ transform: rotate(0deg) scale(1.02); }
  100%{ transform: rotate(360deg) scale(1.02); }
}

/* Confetti */
#confetti{
  position: fixed;
  inset: 0;
  pointer-events:none;
  z-index: 65;
  display:none;
}
body.opened #confetti{ display:block; }

/* Anchor spacing */
section{ scroll-margin-top: 86px; }

/* RESPONSIVE (balik rapi seperti awal) */
@media (max-width: 720px){
  .topbar-inner{ flex-wrap: wrap; gap: 8px; }
  .brand{ min-width: 0; }
  .right{ flex-wrap: wrap; justify-content:flex-end; }
  .coverMedia{ height: 280px; }
}

@media (max-width: 520px){
  body{ font-size: 15px; }
  .container{ padding: 12px 12px calc(100px + env(safe-area-inset-bottom)); }
  .coverWrap{ padding: 12px 10px; }
  .coverCard{ border-radius: 22px; }
  .coverMedia{ height: 240px; }
  .coverTitle{ font-size: clamp(20px, 6.2vw, 30px); padding-left: 40px; }
  .coverTitle::before{ width: 30px; height: 30px; background-size: 30px 30px; top: .22em; }
  .coverDesc{ font-size: 13px; }
  .duaLine{ font-size: 11px; }

  /* tombol cover: 2 kolom, tombol utama full width */
  .btnRow{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    align-items: stretch;
  }
  .btnRow .btn{ width: 100%; }
  .btnRow .btn.primary{ grid-column: 1 / -1; }

  .chip{ height: 32px; padding: 0 9px; }
  .iconBtn{ width: 36px; height: 36px; }

  .grid{ grid-template-columns: 1fr; }
  .countdown{ grid-template-columns: repeat(2,1fr); }

  .bottomNav{ width: calc(100vw - 14px); padding: 8px; gap: 6px; }
  .navItem{ min-height: 48px; }
}

/* =========================
   KAIZEN: Wisuda Anak Islami (Extra Animations)
   ========================= */
.coverHalo{
  position:absolute;
  inset:-18px;
  border-radius: 44px;
  pointer-events:none;
  z-index:0;
  background: conic-gradient(from 0deg,
    rgba(246,196,83,.00),
    rgba(246,196,83,.40),
    rgba(0,183,255,.22),
    rgba(22,163,74,.28),
    rgba(246,196,83,.40),
    rgba(246,196,83,.00)
  );
  filter: blur(16px);
  opacity: .55;
  animation: haloSpin 10s linear infinite;
  mix-blend-mode: soft-light;
}
@keyframes haloSpin{ to{ transform: rotate(360deg); } }

.coverBody .badge{ transform-origin: 20% 50%; animation: badgePop .72s cubic-bezier(.2,.9,.2,1) both; }
.coverBody .badge:nth-child(1){ animation-delay: .06s; }
.coverBody .badge:nth-child(2){ animation-delay: .12s; }
.coverBody .badge:nth-child(3){ animation-delay: .18s; }
@keyframes badgePop{
  0%{ opacity:0; transform: translateY(10px) scale(.92); }
  100%{ opacity:1; transform: translateY(0) scale(1); }
}

.coverTitle{ animation: titleBounce .9s cubic-bezier(.2,.9,.2,1) both; }
@keyframes titleBounce{
  0%{ opacity:0; transform: translateY(10px); }
  70%{ opacity:1; transform: translateY(-2px); }
  100%{ transform: translateY(0); }
}

/* Extra stickers: cap / lantern / laurel */
.sticker.cap,
.sticker.lantern,
.sticker.laurel{
  background-color: transparent;
  background-repeat:no-repeat;
  background-position:center;
  background-size: contain;
  border-radius: 0;
}
.sticker.cap{
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'%3E%3Cpath d='M10 34L48 18l38 16-38 16-38-16Z' fill='%2300B7FF' fill-opacity='.22'/%3E%3Cpath d='M24 44v16c0 10 48 10 48 0V44L48 54 24 44Z' fill='%2316A34A' fill-opacity='.22'/%3E%3Cpath d='M78 37v28' stroke='%23F6C453' stroke-opacity='.55' stroke-width='5' stroke-linecap='round'/%3E%3Ccircle cx='78' cy='69' r='5' fill='%23F6C453' fill-opacity='.55'/%3E%3C/svg%3E");
}
.sticker.lantern{
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'%3E%3Cpath d='M48 10c10 0 18 8 18 18v3H30v-3c0-10 8-18 18-18Z' fill='%23F6C453' fill-opacity='.22'/%3E%3Cpath d='M30 31h36l-6 44H36l-6-44Z' fill='%2300B7FF' fill-opacity='.18'/%3E%3Cpath d='M38 31v44M58 31v44' stroke='%23ffffff' stroke-opacity='.35' stroke-width='3'/%3E%3Cpath d='M44 75h8v7h-8z' fill='%2316A34A' fill-opacity='.22'/%3E%3Cpath d='M48 7v6' stroke='%23ffffff' stroke-opacity='.45' stroke-width='3' stroke-linecap='round'/%3E%3C/svg%3E");
}
.sticker.laurel{
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'%3E%3Cpath d='M34 78c-10-9-16-22-16-36 0-10 3-19 9-27' fill='none' stroke='%2316A34A' stroke-opacity='.26' stroke-width='6' stroke-linecap='round'/%3E%3Cpath d='M62 78c10-9 16-22 16-36 0-10-3-19-9-27' fill='none' stroke='%23F6C453' stroke-opacity='.28' stroke-width='6' stroke-linecap='round'/%3E%3Ccircle cx='48' cy='74' r='7' fill='%23ffffff' fill-opacity='.16'/%3E%3C/svg%3E");
}

/* Twinkle for stars/crescents (no transform here, so it won't fight stickerFloat) */
.sticker.star,
.sticker.crescent{
  animation:
    stickerFloat var(--t, 16s) ease-in-out infinite,
    twinkle 3.2s ease-in-out infinite;
}
@keyframes twinkle{
  0%,100%{ opacity: var(--o,.16); filter: drop-shadow(0 12px 24px rgba(0,60,120,.10)) brightness(1); }
  50%{ opacity: calc(var(--o,.16) + .08); filter: drop-shadow(0 16px 30px rgba(0,60,120,.14)) brightness(1.16); }
}

/* Celebration mode: a short “wow” moment after opening */
body.celebrate::before{ opacity: .26; }
body.celebrate .card{ animation-duration: 5.2s; }
body.celebrate .btn.primary{ filter: brightness(1.07); }

/* Tap sparkle trail (kids vibe) */
.tapSparkle{
  position: fixed;
  width: 18px;
  height: 18px;
  left: 0; top: 0;
  pointer-events:none;
  z-index: 80;
  opacity: 0;
  background: rgba(255,255,255,.85);
  clip-path: polygon(
    50% 0%,
    62% 34%,
    98% 35%,
    69% 57%,
    80% 92%,
    50% 72%,
    20% 92%,
    31% 57%,
    2% 35%,
    38% 34%
  );
  filter: drop-shadow(0 10px 22px rgba(0,60,120,.14));
  animation: sparklePop .75s ease-out forwards;
  mix-blend-mode: soft-light;
}
.tapSparkle.crescent{
  clip-path: none;
  border-radius: 999px;
  background:
    radial-gradient(circle at 38% 50%, rgba(255,255,255,.92) 0 54%, transparent 55%),
    radial-gradient(circle at 58% 50%, transparent 0 46%, rgba(255,255,255,.92) 47% 100%);
  width: 20px; height: 20px;
}
@keyframes sparklePop{
  0%{ opacity:0; transform: translate3d(var(--dx,0px), var(--dy,0px),0) scale(.35) rotate(-12deg); }
  25%{ opacity:1; }
  100%{ opacity:0; transform: translate3d(var(--dx,0px), calc(var(--dy,0px) - 22px),0) scale(1.7) rotate(28deg); }
}

/* Burst pieces (extra celebratory pop on open) */
.burstPiece{
  position: fixed;
  left: 50%;
  top: 40%;
  width: 18px;
  height: 18px;
  pointer-events:none;
  z-index: 80;
  opacity: 0;
  background: rgba(246,196,83,.70);
  clip-path: polygon(
    50% 0%,
    62% 34%,
    98% 35%,
    69% 57%,
    80% 92%,
    50% 72%,
    20% 92%,
    31% 57%,
    2% 35%,
    38% 34%
  );
  filter: drop-shadow(0 14px 30px rgba(0,60,120,.14));
  animation: burstFly .95s cubic-bezier(.2,.9,.2,1) forwards;
}
.burstPiece.blue{ background: rgba(0,183,255,.65); }
.burstPiece.green{ background: rgba(22,163,74,.62); }
.burstPiece.white{ background: rgba(255,255,255,.78); }
.burstPiece.crescent{
  clip-path: none;
  border-radius: 999px;
  background:
    radial-gradient(circle at 38% 50%, rgba(255,255,255,.92) 0 54%, transparent 55%),
    radial-gradient(circle at 58% 50%, transparent 0 46%, rgba(255,255,255,.92) 47% 100%);
  width: 20px; height: 20px;
}
@keyframes burstFly{
  0%{ opacity:0; transform: translate3d(0,0,0) scale(.45) rotate(0deg); }
  18%{ opacity:1; }
  100%{ opacity:0; transform: translate3d(var(--tx,0px), var(--ty,0px),0) scale(1.4) rotate(var(--tr,180deg)); }
}

@media (prefers-reduced-motion: reduce){
  #kidsFx{ display:none; }
  body{ animation:none; }
  .slide{ animation:none; }
  .reveal{ transition:none; }
  .bubble{ animation:none; }
  .carouselTrack{ transition:none; }
  .sticker{ animation:none; }
  .coverHalo{ animation:none; }
  .coverBody .badge{ animation:none; }
  .coverTitle{ animation:none; }
  .tapSparkle, .burstPiece{ animation:none; }

}
  </style>
</head>

<body>
  <div class="islamicPattern" aria-hidden="true"></div>

  <div class="bubbles" aria-hidden="true">
    <div class="bubble" style="left:5%; animation-delay:0s; width:18vmin; height:18vmin;"></div>
    <div class="bubble" style="left:30%; animation-delay:2s; width:22vmin; height:22vmin;"></div>
    <div class="bubble" style="left:65%; animation-delay:4s; width:16vmin; height:16vmin;"></div>
    <div class="bubble" style="left:82%; animation-delay:1s; width:24vmin; height:24vmin;"></div>
  </div>

  <div class="stickers" aria-hidden="true">
    <div class="sticker cloud" style="left:6%;  --s:92px; --o:.18; --t:18s; --x:0px;  animation-delay:-3s;"></div>
    <div class="sticker star"  style="left:18%; --s:56px; --o:.16; --t:15s; --x:10px; animation-delay:-8s;"></div>
    <div class="sticker crescent" style="left:44%; --s:62px; --o:.13; --t:19s; --x:-6px; animation-delay:-11s;"></div>
    <div class="sticker cloud" style="left:72%; --s:86px; --o:.16; --t:20s; --x:-8px; animation-delay:-6s;"></div>
    <div class="sticker star soft" style="left:86%; --s:48px; --o:.14; --t:16s; --x:6px;  animation-delay:-10s;"></div>

    <!-- KAIZEN: extra graduation + islami stickers -->
    <div class="sticker cap" style="left:10%; --s:64px; --o:.14; --t:17s; --x:6px;  animation-delay:-5s;"></div>
    <div class="sticker lantern" style="left:28%; --s:58px; --o:.13; --t:20s; --x:-4px; animation-delay:-12s;"></div>
    <div class="sticker laurel" style="left:56%; --s:66px; --o:.12; --t:21s; --x:2px;  animation-delay:-9s;"></div>
    <div class="sticker cap" style="left:78%; --s:54px; --o:.12; --t:18s; --x:-6px; animation-delay:-14s;"></div>
  </div>

  <canvas id="kidsFx"></canvas>

  <canvas id="confetti"></canvas>

  <!-- Cover -->
  <div class="coverWrap" id="coverWrap">
    <div class="coverCard" role="dialog" aria-modal="true" aria-label="Undangan">
      <div class="coverHalo" aria-hidden="true"></div>
      <div class="coverMedia">
        <div class="slide active" id="slideA"></div>
        <div class="slide" id="slideB"></div>
      </div>
      <div class="coverBody">
        <div class="badgeRow">
          <div class="badge" data-i18n="badge_event">Acara Kelulusan</div>
          <div class="badge" id="badgeDate">24 Januari 2026</div>
          <div class="badge">十日市場地区センター</div>
        </div>

        <div class="toLine" id="toLine" data-i18n="to_default">Kepada Yth: Tamu Undangan</div>
        <div class="coverTitle" data-i18n="cover_title">Undangan Kelulusan Siswa RBM Japan</div>

        <p class="coverDesc" data-i18n="cover_desc">
          Klik tombol di bawah untuk membuka undangan dan mengisi daftar kehadiran/RSVP.
        </p>

        <!-- i18n HTML: aman saat ganti bahasa -->
        <div class="duaLine" data-i18n-html="dua_line"></div>

        <div class="btnRow">
          <button class="btn primary" id="btnOpen" type="button" data-i18n="btn_open">Buka Undangan</button>
          <button class="btn" id="btnShare" type="button" data-i18n="btn_share">Bagikan</button>
          <a class="btn" id="btnMap" target="_blank" rel="noopener" data-i18n="btn_map">Buka Peta</a>
          <button class="btn" id="btnCalendar" type="button" data-i18n="btn_calendar">Tambah ke Kalender</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Top bar -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo">
          <img src="./assets/logo.png" alt="RBM Japan Logo" />
        </div>
        <div>
          <h1 data-i18n="top_title">RBM Japan • Kelulusan</h1>
          <p data-i18n="top_sub">Undangan Web + RSVP</p>
        </div>
      </div>

      <div class="right">
        <div class="chip active" data-lang="id">ID</div>
        <div class="chip" data-lang="en">EN</div>
        <div class="chip" data-lang="ja">日本語</div>
        <div class="iconBtn" id="btnMusic" title="Music">♪</div>
        <div class="iconBtn" id="btnFx" title="FX">✨</div>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="container">
    <section class="section card reveal" id="detail">
      <div class="cardBody">
        <h2 data-i18n="sec_detail">Detail Acara</h2>

        <div class="kv">
          <div class="mutedText" data-i18n="k_when">Waktu</div>
          <div id="whenText"></div>

          <div class="mutedText" data-i18n="k_where">Tempat</div>
          <div>
            <div><b>十日市場地区センター</b></div>
            <div class="mutedText" id="addrText"></div>
          </div>

          <div class="mutedText" data-i18n="k_access">Akses</div>
          <div data-i18n="access_text">± 5–6 menit jalan kaki dari JR 横浜線 十日市場駅.</div>
        </div>

        <div class="hr"></div>

        <h2 data-i18n="sec_countdown">Hitung Mundur</h2>
        <div class="countdown" aria-live="polite">
          <div class="cdBox"><div class="cdNum" id="cdDays">—</div><div class="cdLbl" data-i18n="cd_days">Hari</div></div>
          <div class="cdBox"><div class="cdNum" id="cdHours">—</div><div class="cdLbl" data-i18n="cd_hours">Jam</div></div>
          <div class="cdBox"><div class="cdNum" id="cdMins">—</div><div class="cdLbl" data-i18n="cd_mins">Menit</div></div>
          <div class="cdBox"><div class="cdNum" id="cdSecs">—</div><div class="cdLbl" data-i18n="cd_secs">Detik</div></div>
        </div>

        <div class="hr"></div>

        <div class="quote" data-i18n="note_text">
          Dress code rapi & sopan. Mohon hadir 15 menit lebih awal untuk registrasi.
        </div>
      </div>
    </section>

    <section class="section grid">
      <div class="card reveal" id="hadith">
        <div class="cardBody">
          <h2 data-i18n="sec_hadith">Kutipan Hadits Shahih</h2>
          <div class="arabic">
            وَمَنْ سَلَكَ طَرِيقًا يَلْتَمِسُ فِيهِ عِلْمًا سَهَّلَ اللَّهُ لَهُ بِهِ طَرِيقًا إِلَى الْجَنَّةِ
          </div>
          <div class="quote" id="hadithTranslation"></div>
          <div class="source" id="hadithSource"></div>
        </div>
      </div>

      <div class="card reveal" id="kelas">
        <div class="cardBody">
          <h2 data-i18n="sec_classes">Kelas yang Diwisuda</h2>
          <div class="mutedText" data-i18n="classes_desc">List Kelas yang akan diwisuda</div>
          <div class="hr"></div>
          <div class="classGrid" id="classGrid"></div>
        </div>
      </div>
    </section>

    <section class="section card reveal" id="gallery">
      <div class="cardBody">
        <h2 data-i18n="sec_gallery">Galeri</h2>
        <div class="mutedText" data-i18n="gallery_desc">Galery RBM Jepang</div>
        <div class="hr"></div>

        <div class="carousel" id="galleryCarousel">
          <div class="carouselTrack" id="carouselTrack"></div>

          <button class="carouselCtrl prev" id="carPrev" type="button" aria-label="prev">‹</button>
          <button class="carouselCtrl next" id="carNext" type="button" aria-label="next">›</button>

          <div class="carouselDots" id="carouselDots"></div>
        </div>
      </div>
    </section>

    <div class="lightbox" id="lightbox" aria-hidden="true">
      <img id="lightboxImg" alt="preview" />
    </div>

    <section class="section card reveal" id="rsvp">
      <div class="cardBody">
        <h2 data-i18n="sec_rsvp">RSVP (Konfirmasi Kehadiran)</h2>
        <div class="mutedText" data-i18n="rsvp_hint">Isi form di bawah.</div>

        <div class="notice">
          <b data-i18n="men_notice_title">Pengumuman:</b>
          <span data-i18n="men_notice_body">Untuk Bapak-bapak, mohon menunggu di luar ruangan.</span>
        </div>

        <div class="hr"></div>

        <form id="rsvpForm">
          <div class="row2">
            <div>
              <label data-i18n="f_name">Nama</label>
              <input name="name" autocomplete="name" required placeholder="Nama Anda" />
            </div>
            <div>
              <label data-i18n="f_contact">Kontak (Email / WhatsApp)</label>
              <input name="contact" autocomplete="email" placeholder="opsional" />
            </div>
          </div>

          <div>
            <label data-i18n="f_attendance">Kehadiran</label>
            <div class="radioRow">
              <label class="radio"><input type="radio" name="attendance" value="yes" required /><span data-i18n="att_yes">Hadir</span></label>
              <label class="radio"><input type="radio" name="attendance" value="no" /><span data-i18n="att_no">Tidak dapat hadir</span></label>
              <label class="radio"><input type="radio" name="attendance" value="maybe" /><span data-i18n="att_maybe">Masih ragu</span></label>
            </div>
          </div>

          <div>
            <label data-i18n="f_guests">Jumlah orang</label>
            <select name="guests">
              <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option>
            </select>
          </div>

          <div>
            <label data-i18n="f_note">Catatan (opsional)</label>
            <textarea name="note" placeholder="Contoh: hadir 2 orang, dsb."></textarea>
          </div>

          <div>
            <label>Pesan / Ucapan</label>
            <textarea name="message" required placeholder="Tulis ucapan singkat..."></textarea>
          </div>

          <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
            <button class="btn ok" type="submit" data-i18n="btn_submit">Kirim RSVP</button>
            <button class="btn danger" type="button" id="btnReset" data-i18n="btn_reset">Reset</button>
            <span class="mutedText" id="saveInfo"></span>
          </div>
        </form>
      </div>
    </section>
  </div>

  <nav class="bottomNav" aria-label="Navigation">
    <a class="navItem active" href="#detail" data-nav="detail">
      <svg viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <span>Detail</span>
    </a>
    <a class="navItem" href="#kelas" data-nav="kelas">
      <svg viewBox="0 0 24 24" fill="none"><path d="M4 19V7l8-4 8 4v12l-8 4-8-4Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
      <span>Kelas</span>
    </a>
    <a class="navItem" href="#gallery" data-nav="gallery">
      <svg viewBox="0 0 24 24" fill="none"><path d="M4 7h16v12H4V7Z" stroke="currentColor" stroke-width="2"/><path d="M8 11l2 2 3-3 5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <span>Galeri</span>
    </a>
    <a class="navItem" href="#rsvp" data-nav="rsvp">
      <svg viewBox="0 0 24 24" fill="none"><path d="M7 12l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 12a8 8 0 1 1-16 0 8 8 0 0 1 16 0Z" stroke="currentColor" stroke-width="2"/></svg>
      <span>RSVP</span>
    </a>
  </nav>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <audio id="bgm" loop preload="none">
    <source src="./assets/bgm.mp3" type="audio/mpeg" />
  </audio>

  <script>
/***********************
 * CONFIG
 ***********************/
const CONFIG = {
  eventTitle: "RBM Japan Student Graduation Ceremony",
  startISO: "2026-01-24T13:00:00+09:00",
  endISO:   "2026-01-24T16:00:00+09:00",
  venueName: "十日市場地区センター",
  addressLine: "〒226-0025 神奈川県横浜市緑区十日市場町808-3",
  mapQuery: "十日市場地区センター",

  ENDPOINT: "https://script.google.com/macros/s/AKfycbwGA8_bsewf_rmdF4DbRQoT0pRR2dQ03DUHRwZIJP0K847smDncQWiNQzur9Cl34eKu/exec",

  coverImages: [
    "./assets/photos/01.jpg",
    "./assets/photos/02.jpg",
    "./assets/photos/03.jpg",
    "./assets/photos/a.jpeg",
    "./assets/photos/b.jpeg",
    "./assets/photos/c.jpeg",
    "./assets/photos/d.jpeg",
    "./assets/photos/e.jpeg",
    "./assets/photos/f.jpeg",
    "./assets/photos/g.jpeg",
    "./assets/photos/h.jpeg"
  ],

  autoGallery: {
    enabled: true,
    prefix: "./assets/photos/",
    start: 1,
    end: 50,
    pad: 2,
    ext: "jpg"
  },

  galleryImages: [
    "./assets/photos/01.jpg",
    "./assets/photos/02.jpg",
    "./assets/photos/03.jpg"
  ],

  classes: [
    { name: "Kelas Qur’an Darat", desc: "Program pembinaan tilawah dan pemahaman dasar.", i18nNameKey:"class_quran_darat", i18nDescKey:"class_quran_darat_desc" },
    { name: "Kelas Iqro’ Darat", desc: "Penguatan baca tulis Al-Qur’an (tahap Iqro’).", i18nNameKey:"class_iqro_darat", i18nDescKey:"class_iqro_darat_desc" },
    { name: "Kelas PAI Semester 1", desc: "Materi PAI semester 1.", i18nNameKey:"class_pai_s1", i18nDescKey:"class_pai_s1_desc" },
    { name: "Kelas PAI Semester 2", desc: "Materi PAI semester 2.", i18nNameKey:"class_pai_s2", i18nDescKey:"class_pai_s2_desc" },
    { name: "Kelas Nuroniyah", desc: "Kelas Nuroniyah", i18nNameKey:"class_nuroniyah", i18nDescKey:"class_nuroniyah_desc" }
  ]
};

/***********************
 * i18n (NOTE: dua_line pakai HTML)
 ***********************/
const I18N = {
  id: {
    top_title:"RBM Japan • Kelulusan",
    top_sub:"Undangan Web + RSVP",
    badge_event:"Acara Kelulusan",
    to_default:"Kepada Yth: Tamu Undangan",
    cover_title:"Undangan Kelulusan Siswa RBM Japan",
    cover_desc:"Klik tombol di bawah untuk membuka undangan dan mengisi daftar hadir/RSVP.",
    dua_line:`<span class="duaAr">بارك الله فيكم</span><span class="duaSep">—</span><span class="duaLt">Semoga Allah memberkahi.</span>`,
    btn_open:"Buka Undangan",
    btn_share:"Bagikan",
    btn_map:"Buka Peta",
    btn_calendar:"Tambah ke Kalender",

    sec_detail:"Detail Acara",
    k_when:"Waktu", k_where:"Tempat", k_access:"Akses",
    access_text:"± 5–6 menit jalan kaki dari JR 横浜線 十日市場駅.",
    sec_countdown:"Hitung Mundur",
    cd_days:"Hari", cd_hours:"Jam", cd_mins:"Menit", cd_secs:"Detik",
    note_text:"Dress code rapi & sopan. Mohon hadir 15 menit lebih awal untuk registrasi.",

    sec_hadith:"Kutipan Hadits Shahih",
    hadith_tr:"“Barangsiapa menempuh jalan untuk mencari ilmu, maka Allah akan memudahkan baginya jalan menuju surga.”",
    hadith_src:"HR. Muslim (no. 2699) — potongan lafaz tentang menuntut ilmu.",

    sec_classes:"Kelas yang Diwisuda",
    classes_desc:"Kelas yang akan diwisuda",
    class_quran_darat:"Kelas Qur’an Darat",
    class_quran_darat_desc:"Program pembinaan tilawah dan pemahaman dasar.",
    class_iqro_darat:"Kelas Iqro’ Darat",
    class_iqro_darat_desc:"Penguatan baca tulis Al-Qur’an (tahap Iqro’).",
    class_pai_s1:"Kelas PAI Semester 1",
    class_pai_s1_desc:"Materi PAI semester 1.",
    class_pai_s2:"Kelas PAI Semester 2",
    class_pai_s2_desc:"Materi PAI semester 2.",
    class_nuroniyah:"Kelas Nuroniyah",
    class_nuroniyah_desc:"Kelas Nuroniyah",

    sec_gallery:"Galeri",
    gallery_desc:"Galeri RBM Jepang",

    sec_rsvp:"RSVP (Konfirmasi Kehadiran)",
    rsvp_hint:"Isi form di bawah.",
    men_notice_title:"Pengumuman:",
    men_notice_body:"Untuk Bapak-bapak, mohon menunggu di luar ruangan.",

    f_name:"Nama",
    f_contact:"Kontak (Email / WhatsApp)",
    f_attendance:"Kehadiran",
    att_yes:"Hadir", att_no:"Tidak dapat hadir", att_maybe:"Masih ragu",
    f_guests:"Jumlah orang",
    f_note:"Catatan (opsional)",
    btn_submit:"Kirim RSVP",
    btn_reset:"Reset",

    toast_share:"Link undangan disalin.",
    toast_music_on:"Musik: ON",
    toast_music_off:"Musik: OFF",
    toast_saved_local:"Tersimpan di perangkat.",
    toast_sent:"Terkirim.",
    toast_failed:"Tersimpan di perangkat. (Server belum merespons)"
  },
  en: {
    top_title:"RBM Japan • Graduation",
    top_sub:"Web Invitation + RSVP",
    badge_event:"Graduation Ceremony",
    to_default:"To: Invited Guest",
    cover_title:"RBM Japan Student Graduation Ceremony Invitation",
    cover_desc:"Let’s celebrate our students’ achievement. Tap below to open the invitation and submit your RSVP.",
    dua_line:`<span class="duaAr">بارك الله فيكم</span><span class="duaSep">—</span><span class="duaLt">May Allah bless you.</span>`,
    btn_open:"Open Invitation",
    btn_share:"Share",
    btn_map:"Open Map",
    btn_calendar:"Add to Calendar",

    sec_detail:"Event Details",
    k_when:"When", k_where:"Where", k_access:"Access",
    access_text:"Approx. 5–6 minutes walk from JR Yokohama Line Tokaichiba Station.",
    sec_countdown:"Countdown",
    cd_days:"Days", cd_hours:"Hours", cd_mins:"Minutes", cd_secs:"Seconds",
    note_text:"Dress neatly and respectfully. Please arrive 15 minutes early for registration.",

    sec_hadith:"Authentic Hadith Quote",
    hadith_tr:"“Whoever travels a path in search of knowledge, Allah will make easy for him a path to Paradise.”",
    hadith_src:"Sahih Muslim (no. 2699) — excerpt on seeking knowledge.",

    sec_classes:"Graduating Classes",
    classes_desc:"Class list",
    class_quran_darat:"On-site Qur’an Class",
    class_quran_darat_desc:"Program for recitation (tilawah) and basic understanding.",
    class_iqro_darat:"On-site Iqro’ Class",
    class_iqro_darat_desc:"Strengthening Qur’an reading & writing (Iqro’ level).",
    class_pai_s1:"PAI Semester 1",
    class_pai_s1_desc:"Islamic Studies (PAI) – Semester 1.",
    class_pai_s2:"PAI Semester 2",
    class_pai_s2_desc:"Islamic Studies (PAI) – Semester 2.",
    class_nuroniyah:"Nuroniyah Class",
    class_nuroniyah_desc:"Nuroniyah class.",

    sec_gallery:"Gallery",
    gallery_desc:"RBM Japan Gallery",

    sec_rsvp:"RSVP (Attendance Confirmation)",
    rsvp_hint:"Fill in the form.",
    men_notice_title:"Notice:",
    men_notice_body:"For fathers/men, please wait outside the room.",

    f_name:"Name",
    f_contact:"Contact (Email / WhatsApp)",
    f_attendance:"Attendance",
    att_yes:"Attending", att_no:"Not attending", att_maybe:"Maybe",
    f_guests:"Number of people",
    f_note:"Note (optional)",
    btn_submit:"Submit RSVP",
    btn_reset:"Reset",

    toast_share:"Invitation link copied.",
    toast_music_on:"Music: ON",
    toast_music_off:"Music: OFF",
    toast_saved_local:"Saved on your device.",
    toast_sent:"Sent.",
    toast_failed:"Saved on device. (Server not responding)"
  },
  ja: {
    top_title:"RBM Japan • 卒業式",
    top_sub:"Web招待状 + RSVP",
    badge_event:"卒業式",
    to_default:"ご招待：ゲスト様",
    cover_title:"RBM Japan 卒業式のご案内",
    cover_desc:"生徒の門出を一緒にお祝いしましょう。下のボタンから招待状を開き、出欠をご回答ください。",
    dua_line:`<span class="duaAr">بارك الله فيكم</span><span class="duaSep">—</span><span class="duaLt">アッラーの祝福がありますように。</span>`,
    btn_open:"招待状を開く",
    btn_share:"共有",
    btn_map:"地図を開く",
    btn_calendar:"カレンダーに追加",

    sec_detail:"開催情報",
    k_when:"日時", k_where:"会場", k_access:"アクセス",
    access_text:"JR横浜線「十日市場駅」から徒歩約5〜6分。",
    sec_countdown:"カウントダウン",
    cd_days:"日", cd_hours:"時間", cd_mins:"分", cd_secs:"秒",
    note_text:"服装は清潔感のあるものを推奨します。受付のため15分前のご来場にご協力ください。",

    sec_hadith:"真正なハディースの引用",
    hadith_tr:"「知識を求めて道を歩む者には、アッラーが楽園への道を容易にして下さる」",
    hadith_src:"サヒーフ・ムスリム（2699）— 知識探求に関する一節。",

    sec_classes:"卒業クラス",
    classes_desc:"クラス一覧",
    class_quran_darat:"クルアーン教室（対面）",
    class_quran_darat_desc:"ティラーワと基礎理解の育成プログラム。",
    class_iqro_darat:"イクロ（対面）",
    class_iqro_darat_desc:"クルアーンの読み書き強化（イクロ段階）。",
    class_pai_s1:"PAI（イスラーム学習）1学期",
    class_pai_s1_desc:"PAI 1学期の学習内容。",
    class_pai_s2:"PAI（イスラーム学習）2学期",
    class_pai_s2_desc:"PAI 2学期の学習内容。",
    class_nuroniyah:"ヌローニーヤ教室",
    class_nuroniyah_desc:"ヌローニーヤのクラス。",

    sec_gallery:"ギャラリー",
    gallery_desc:"写真一覧",

    sec_rsvp:"RSVP（出欠回答）",
    rsvp_hint:"フォームにご入力ください。",
    men_notice_title:"お知らせ：",
    men_notice_body:"男性（お父様）は室外でお待ちください。",

    f_name:"お名前",
    f_contact:"連絡先（Email / WhatsApp）",
    f_attendance:"出欠",
    att_yes:"出席", att_no:"欠席", att_maybe:"未定",
    f_guests:"人数",
    f_note:"備考（任意）",
    btn_submit:"送信",
    btn_reset:"リセット",

    toast_share:"リンクをコピーしました。",
    toast_music_on:"音楽：ON",
    toast_music_off:"音楽：OFF",
    toast_saved_local:"端末に保存しました。",
    toast_sent:"送信しました。",
    toast_failed:"端末に保存しました。（サーバー未応答）"
  }
};

/***********************
 * Helpers
 ***********************/
const $ = (q)=>document.querySelector(q);
const $$ = (q)=>Array.from(document.querySelectorAll(q));
const state = { lang:"id", musicOn:false, opened:false };

function toast(msg){
  const t = $("#toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(toast._timer);
  toast._timer = setTimeout(()=>t.classList.remove("show"), 3200);
}
function pad2(n){ return String(n).padStart(2,"0"); }

function formatWhen(lang){
  const s = new Date(CONFIG.startISO);
  const e = new Date(CONFIG.endISO);
  const yyyy = s.getFullYear();
  const mm = s.getMonth()+1;
  const dd = s.getDate();
  const dow = s.getDay();
  const dowId = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"][dow];
  const dowEn = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][dow];
  const dowJa = ["日","月","火","水","木","金","土"][dow];
  const time = `${pad2(s.getHours())}:${pad2(s.getMinutes())}–${pad2(e.getHours())}:${pad2(e.getMinutes())} JST`;
  if(lang==="id") return `${dowId}, ${dd} Januari ${yyyy} • ${time}`;
  if(lang==="en") return `${dowEn}, January ${dd}, ${yyyy} • ${time}`;
  return `${yyyy}年${mm}月${dd}日（${dowJa}） • ${time}`;
}
function getQueryParam(name){
  const u = new URL(location.href);
  return u.searchParams.get(name);
}
function safeText(s){
  return String(s || "").replace(/[<>&"]/g, c => ({ "<":"&lt;", ">":"&gt;", "&":"&amp;", "\"":"&quot;" }[c]));
}

/***********************
 * Language (textContent + HTML keys)
 ***********************/
function setLang(lang){
  state.lang = lang;
  document.documentElement.lang = lang;

  $$(".chip").forEach(c=>c.classList.toggle("active", c.dataset.lang===lang));

  // text i18n
  $$("[data-i18n]").forEach(el=>{
    const key = el.getAttribute("data-i18n");
    if(I18N[lang] && I18N[lang][key] != null) el.textContent = I18N[lang][key];
  });

  // HTML i18n (khusus dua_line)
  $$("[data-i18n-html]").forEach(el=>{
    const key = el.getAttribute("data-i18n-html");
    if(I18N[lang] && I18N[lang][key] != null) el.innerHTML = I18N[lang][key];
  });

  $("#hadithTranslation").textContent = I18N[lang].hadith_tr;
  $("#hadithSource").textContent = I18N[lang].hadith_src;

  $("#whenText").textContent = formatWhen(lang);
  $("#addrText").textContent = CONFIG.addressLine;
  $("#btnMap").href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(CONFIG.mapQuery)}`;

  // re-render dynamic sections that are not data-i18n based
  renderClasses();
}

/***********************
 * Cover slideshow
 ***********************/
function startSlides(){
  const a = $("#slideA");
  const b = $("#slideB");
  const imgs = (CONFIG.coverImages || []).filter(Boolean);
  if(imgs.length === 0) return;

  const setBg = (el, url)=> el.style.backgroundImage = `url("${url}")`;

  let current = a;
  let next = b;
  let idx = 0;

  setBg(current, imgs[idx]);
  current.classList.add("active");

  setBg(next, imgs[(idx+1) % imgs.length]);
  next.classList.remove("active");

  setInterval(()=>{
    idx = (idx + 1) % imgs.length;

    setBg(next, imgs[idx]);
    next.classList.add("active");
    current.classList.remove("active");

    const tmp = current;
    current = next;
    next = tmp;
  }, 5500);
}

/***********************
 * Countdown
 ***********************/
function startCountdown(){
  const target = new Date(CONFIG.startISO).getTime();
  function tick(){
    const now = Date.now();
    let diff = Math.max(0, target - now);

    const d = Math.floor(diff / (24*3600*1000)); diff -= d*24*3600*1000;
    const h = Math.floor(diff / (3600*1000)); diff -= h*3600*1000;
    const m = Math.floor(diff / (60*1000)); diff -= m*60*1000;
    const s = Math.floor(diff / 1000);

    $("#cdDays").textContent = d;
    $("#cdHours").textContent = pad2(h);
    $("#cdMins").textContent = pad2(m);
    $("#cdSecs").textContent = pad2(s);
  }
  tick();
  setInterval(tick, 1000);
}

/***********************
 * Calendar (.ics)
 ***********************/
function buildICS(){
  const dtStart = new Date(CONFIG.startISO);
  const dtEnd = new Date(CONFIG.endISO);
  const toICS = (d)=>{
    const u = new Date(d.getTime());
    const yyyy = u.getUTCFullYear();
    const mm = pad2(u.getUTCMonth()+1);
    const dd = pad2(u.getUTCDate());
    const hh = pad2(u.getUTCHours());
    const mi = pad2(u.getUTCMinutes());
    const ss = pad2(u.getUTCSeconds());
    return `${yyyy}${mm}${dd}T${hh}${mi}${ss}Z`;
  };
  const uid = `rbm-grad-${Date.now()}@rbm-japan`;
  return [
    "BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//RBM Japan//Graduation//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH",
    "BEGIN:VEVENT",
    `UID:${uid}`,
    `DTSTAMP:${toICS(new Date())}`,
    `DTSTART:${toICS(dtStart)}`,
    `DTEND:${toICS(dtEnd)}`,
    `SUMMARY:${CONFIG.eventTitle}`,
    `LOCATION:${CONFIG.venueName} (${CONFIG.addressLine})`,
    "DESCRIPTION:RBM Japan Graduation Ceremony",
    "END:VEVENT",
    "END:VCALENDAR"
  ].join("\r\n");
}

/***********************
 * Share
 ***********************/
async function shareLink(){
  const url = location.href;
  try{
    if(navigator.share){
      await navigator.share({ title: document.title, url });
      return;
    }
    await navigator.clipboard.writeText(url);
    toast(I18N[state.lang].toast_share);
  }catch{
    prompt("Copy link:", url);
  }
}

/***********************
 * Ripple
 ***********************/
function addRipple(e){
  const btn = e.currentTarget;
  const r = document.createElement("span");
  r.className = "ripple";
  const rect = btn.getBoundingClientRect();
  const x = (e.clientX || (rect.left + rect.width/2)) - rect.left;
  const y = (e.clientY || (rect.top + rect.height/2)) - rect.top;
  r.style.left = `${x}px`;
  r.style.top = `${y}px`;
  r.style.width = r.style.height = `${Math.max(rect.width, rect.height)}px`;
  btn.appendChild(r);
  setTimeout(()=>r.remove(), 600);
}

/***********************
 * Confetti
 ***********************/
function confettiBurst(durationMs=1400){
  const canvas = $("#confetti");
  const ctx = canvas.getContext("2d");
  const dpr = Math.max(1, window.devicePixelRatio || 1);

  function resize(){
    canvas.width = Math.floor(innerWidth * dpr);
    canvas.height = Math.floor(innerHeight * dpr);
    canvas.style.width = innerWidth + "px";
    canvas.style.height = innerHeight + "px";
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  resize();
  window.addEventListener("resize", resize, { passive:true });

  const colors = ["#ffffff","#F6C453","#FF8A00","#1A56FF"];
  const parts = Array.from({length: 110}, ()=>({
    x: Math.random()*innerWidth,
    y: -20 - Math.random()*innerHeight*0.2,
    vx: (Math.random()*2-1)*3,
    vy: 3 + Math.random()*6,
    w: 4 + Math.random()*5,
    h: 6 + Math.random()*8,
    rot: Math.random()*Math.PI,
    vr: (Math.random()*2-1)*0.2,
    c: colors[Math.floor(Math.random()*colors.length)]
  }));

  const t0 = performance.now();
  function frame(t){
    const dt = (t - t0);
    ctx.clearRect(0,0,innerWidth,innerHeight);

    parts.forEach(p=>{
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.05;
      p.rot += p.vr;
      if(p.x < -30) p.x = innerWidth + 30;
      if(p.x > innerWidth + 30) p.x = -30;

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.c;
      ctx.globalAlpha = 0.95;
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    });

    if(dt < durationMs){
      requestAnimationFrame(frame);
    }else{
      ctx.clearRect(0,0,innerWidth,innerHeight);
      window.removeEventListener("resize", resize);
    }
  }
  requestAnimationFrame(frame);
}

/***********************
 * KAIZEN: Kids sparkle trail + burst (wisuda islami)
 ***********************/
function celebrateMode(ms=2600){
  document.body.classList.add("celebrate");
  clearTimeout(celebrateMode._t);
  celebrateMode._t = setTimeout(()=>document.body.classList.remove("celebrate"), ms);
}

function spawnTapSparkles(x, y, count=4){
  const frag = document.createDocumentFragment();
  for(let i=0;i<count;i++){
    const sp = document.createElement("span");
    const cres = Math.random() < 0.28;
    sp.className = "tapSparkle" + (cres ? " crescent" : "");
    const jitterX = (Math.random()*2-1) * 14;
    const jitterY = (Math.random()*2-1) * 12;
    sp.style.left = (x + jitterX) + "px";
    sp.style.top  = (y + jitterY) + "px";
    sp.style.setProperty("--dx", ((Math.random()*2-1) * 18) + "px");
    sp.style.setProperty("--dy", ((Math.random()*2-1) * 10) + "px");
    frag.appendChild(sp);
    setTimeout(()=>sp.remove(), 900);
  }
  document.body.appendChild(frag);
}

function starsBurst(){
  // origin: center of cover card if visible, else center of screen
  let ox = innerWidth/2, oy = innerHeight*0.35;
  const cc = document.querySelector(".coverCard");
  if(cc){
    const r = cc.getBoundingClientRect();
    ox = r.left + r.width/2;
    oy = r.top + r.height*0.38;
  }
  const colors = ["white","blue","green"];
  const n = 26;
  for(let i=0;i<n;i++){
    const el = document.createElement("span");
    const isCres = Math.random() < 0.22;
    el.className = "burstPiece " + colors[Math.floor(Math.random()*colors.length)] + (isCres ? " crescent" : "");
    el.style.left = ox + "px";
    el.style.top  = oy + "px";

    const ang = Math.random() * Math.PI * 2;
    const dist = 140 + Math.random()*180;
    el.style.setProperty("--tx", (Math.cos(ang)*dist) + "px");
    el.style.setProperty("--ty", (Math.sin(ang)*dist) + "px");
    el.style.setProperty("--tr", (Math.random()*360) + "deg");

    document.body.appendChild(el);
    setTimeout(()=>el.remove(), 1100);
  }
}

// Sparkle trail on tap/click (lightweight)
document.addEventListener("pointerdown", (e)=>{
  // avoid stealing interactions: purely visual
  if(!e.isPrimary) return;
  spawnTapSparkles(e.clientX, e.clientY, 4);
}, { passive:true });

/***********************
 * Reveal
 ***********************/
function initReveal(){
  const els = $$(".reveal");
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(en=>{
      if(en.isIntersecting) en.target.classList.add("show");
    });
  }, { threshold: 0.12 });
  els.forEach(el=>io.observe(el));
}

/***********************
 * Classes
 ***********************/
function renderClasses(){
  const lang = state.lang || "id";
  $("#classGrid").innerHTML = CONFIG.classes.map(c=>{
    const tName = (c.i18nNameKey && I18N[lang] && I18N[lang][c.i18nNameKey] != null) ? I18N[lang][c.i18nNameKey] : c.name;
    const tDesc = (c.i18nDescKey && I18N[lang] && I18N[lang][c.i18nDescKey] != null) ? I18N[lang][c.i18nDescKey] : (c.desc || "");
    return `
      <div class="classCard">
        <b>${safeText(tName)}</b>
        <div class="small">${safeText(tDesc)}</div>
      </div>
    `;
  }).join("");
}

/***********************
 * Gallery Carousel (auto detect 01..N)
 ***********************/
let CAR = { imgs:[], idx:0, timer:null, dragging:false, startX:0, dx:0 };

function padN(n, pad){
  const s = String(n);
  return s.length >= pad ? s : "0".repeat(pad - s.length) + s;
}
async function loadImage(url){
  try{
    const res = await fetch(url, { method:"HEAD", cache:"no-cache" });
    return { ok: res.ok, url };
  }catch{
    return { ok:false, url };
  }
}
async function discoverGalleryImages(){
  if(CONFIG.autoGallery && CONFIG.autoGallery.enabled){
    const { prefix, start, end, pad, ext } = CONFIG.autoGallery;
    const candidates = [];
    for(let i=start; i<=end; i++){
      candidates.push(prefix + padN(i, pad) + "." + ext);
    }
    const results = await Promise.all(candidates.map(loadImage));
    const found = results.filter(r=>r.ok).map(r=>r.url);
    if(found.length) return found;
  }
  return (CONFIG.galleryImages || []).filter(Boolean);
}
function buildDots(){
  const dots = $("#carouselDots");
  dots.innerHTML = CAR.imgs.map((_, i)=>`<span class="dot ${i===CAR.idx?"active":""}" data-i="${i}"></span>`).join("");
  $$("#carouselDots .dot").forEach(d=>{
    d.addEventListener("click", ()=>{
      goToSlide(parseInt(d.dataset.i,10));
      restartAutoplay();
    });
  });
}
function updateCarousel(){
  const track = $("#carouselTrack");
  const w = $("#galleryCarousel").clientWidth;
  track.style.transform = `translateX(${-(CAR.idx*w)}px)`;
  $$("#carouselDots .dot").forEach((d,i)=> d.classList.toggle("active", i===CAR.idx));
}
function goToSlide(i){
  if(!CAR.imgs.length) return;
  CAR.idx = (i + CAR.imgs.length) % CAR.imgs.length;
  updateCarousel();
}
function nextSlide(){ goToSlide(CAR.idx + 1); }
function prevSlide(){ goToSlide(CAR.idx - 1); }
function startAutoplay(){
  stopAutoplay();
  CAR.timer = setInterval(nextSlide, 4200);
}
function stopAutoplay(){
  if(CAR.timer){ clearInterval(CAR.timer); CAR.timer = null; }
}
function restartAutoplay(){ stopAutoplay(); startAutoplay(); }

async function renderGallery(){
  const track = $("#carouselTrack");
  track.innerHTML = `<div class="mutedText" style="padding:12px;">Loading...</div>`;

  const imgs = await discoverGalleryImages();
  CAR.imgs = imgs;
  CAR.idx = 0;

  if(!imgs.length){
    track.innerHTML = `<div class="mutedText" style="padding:12px;">Belum ada foto.</div>`;
    $("#carouselDots").innerHTML = "";
    return;
  }

  track.innerHTML = imgs.map((src, idx)=>`
    <div class="carouselItem" data-src="${safeText(src)}" data-idx="${idx}">
      <img src="${safeText(src)}" alt="photo ${idx+1}">
    </div>
  `).join("");

  $$("#carouselTrack .carouselItem").forEach(el=>{
    el.addEventListener("click", ()=>{
      $("#lightboxImg").src = el.dataset.src;
      $("#lightbox").classList.add("show");
      $("#lightbox").setAttribute("aria-hidden","false");
      stopAutoplay();
    });
  });

  buildDots();
  updateCarousel();
  startAutoplay();

  $("#carNext").onclick = ()=>{ nextSlide(); restartAutoplay(); };
  $("#carPrev").onclick = ()=>{ prevSlide(); restartAutoplay(); };

  const car = $("#galleryCarousel");
  car.addEventListener("pointerdown", (e)=>{
    CAR.dragging = true;
    CAR.startX = e.clientX;
    CAR.dx = 0;
    stopAutoplay();
    car.setPointerCapture(e.pointerId);
  });
  car.addEventListener("pointermove", (e)=>{
    if(!CAR.dragging) return;
    CAR.dx = e.clientX - CAR.startX;
    const w = car.clientWidth;
    const track = $("#carouselTrack");
    track.style.transition = "none";
    track.style.transform = `translateX(${-(CAR.idx*w) + CAR.dx}px)`;
  });
  function endDrag(){
    if(!CAR.dragging) return;
    CAR.dragging = false;
    const w = car.clientWidth;
    const track = $("#carouselTrack");
    track.style.transition = "";
    const threshold = Math.min(80, w * 0.18);
    if(CAR.dx > threshold) prevSlide();
    else if(CAR.dx < -threshold) nextSlide();
    updateCarousel();
    restartAutoplay();
  }
  car.addEventListener("pointerup", endDrag);
  car.addEventListener("pointercancel", endDrag);

  window.addEventListener("resize", ()=>updateCarousel(), { passive:true });
}

/***********************
 * Lightbox close
 ***********************/
$("#lightbox").addEventListener("click", ()=>{
  $("#lightbox").classList.remove("show");
  $("#lightbox").setAttribute("aria-hidden","true");
  $("#lightboxImg").src = "";
  restartAutoplay();
});

/***********************
 * Music
 ***********************/
async function toggleMusic(){
  const audio = $("#bgm");
  try{
    if(!state.musicOn){
      await audio.play();
      state.musicOn = true;
      toast(I18N[state.lang].toast_music_on);
    }else{
      audio.pause();
      state.musicOn = false;
      toast(I18N[state.lang].toast_music_off);
    }
  }catch{
    toast("Musik tidak bisa diputar (cek assets/bgm.mp3).");
  }
}
$("#btnMusic").addEventListener("click", toggleMusic);

/***********************
 * Bottom nav active
 ***********************/
function initBottomNav(){
  const items = $$(".navItem");
  const sections = items.map(i => document.getElementById(i.getAttribute("href").slice(1))).filter(Boolean);

  const io = new IntersectionObserver((entries)=>{
    let best = null;
    for(const e of entries){
      if(e.isIntersecting){
        if(!best || e.intersectionRatio > best.intersectionRatio) best = e;
      }
    }
    if(best){
      const id = best.target.id;
      items.forEach(it=>it.classList.toggle("active", it.getAttribute("href")==="#"+id));
    }
  }, { threshold: [0.2, 0.35, 0.5, 0.65] });

  sections.forEach(s=>io.observe(s));
}

/***********************
 * RSVP
 ***********************/
const KEY_RSVP = "rbm_rsvp_latest_v1";

async function postToEndpoint(payload){
  if(!CONFIG.ENDPOINT) return { ok:false, reason:"no-endpoint" };

  const params = new URLSearchParams();
  for(const [k,v] of Object.entries(payload)){
    if(v == null) continue;
    if(typeof v === "object") params.set(k, JSON.stringify(v));
    else params.set(k, String(v));
  }

  try{
    if(navigator.sendBeacon){
      const blob = new Blob([params.toString()], { type:"application/x-www-form-urlencoded;charset=UTF-8" });
      const ok = navigator.sendBeacon(CONFIG.ENDPOINT, blob);
      return { ok, via:"beacon" };
    }
  }catch{}

  try{
    await fetch(CONFIG.ENDPOINT, {
      method: "POST",
      mode: "no-cors",
      body: params
    });
    return { ok:true, via:"no-cors" };
  }catch(e){
    return { ok:false, reason:String(e) };
  }
}

$("#rsvpForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);

  const payload = {
    type: "rsvp",
    name: String(fd.get("name")||"").trim(),
    contact: String(fd.get("contact")||"").trim(),
    attendance: String(fd.get("attendance")||""),
    guests: String(fd.get("guests")||"1"),
    lang: state.lang,

    message: String(fd.get("message")||"").trim(),
    note: String(fd.get("note")||"").trim(),
    ts: new Date().toISOString(),
    page: location.href,
    eventTitle: CONFIG.eventTitle,
    startISO: CONFIG.startISO,
    venue: CONFIG.venueName
  };

  localStorage.setItem(KEY_RSVP, JSON.stringify(payload));
  $("#saveInfo").textContent = I18N[state.lang].toast_saved_local;

  if(CONFIG.ENDPOINT){
    const res = await postToEndpoint(payload);
    if(res && res.ok) toast(I18N[state.lang].toast_sent);
    else toast(I18N[state.lang].toast_failed);
  }else{
    toast(I18N[state.lang].toast_saved_local);
  }

  e.target.reset();
});
$("#btnReset").addEventListener("click", ()=>{
  $("#rsvpForm").reset();
  $("#saveInfo").textContent = "";
});

/***********************
 * Cover open flow
 ***********************/
function openInvitation(){
  if(state.opened) return;
  state.opened = true;

  document.body.classList.add("opened");
  confettiBurst(1400);
  // KAIZEN: extra burst + short celebration mode
  starsBurst();
  celebrateMode(2600);
  setTimeout(()=> document.getElementById("detail").scrollIntoView({behavior:"smooth", block:"start"}), 180);
}

$("#btnOpen").addEventListener("click", (e)=>{ addRipple(e); openInvitation(); });
$("#btnShare").addEventListener("click", (e)=>{ addRipple(e); shareLink(); });
$("#btnCalendar").addEventListener("click", (e)=>{
  addRipple(e);
  const ics = buildICS();
  const blob = new Blob([ics], { type:"text/calendar;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "RBM-Japan-Graduation.ics";
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 800);
});

/***********************
 * Language controls
 ***********************/
$$(".chip").forEach(ch => ch.addEventListener("click", ()=> setLang(ch.dataset.lang)));

/***********************
 * Personalization ?to=
 ***********************/
const to = getQueryParam("to");
if(to){
  const name = decodeURIComponent(to);
  const t = $("#toLine");
  t.textContent = `Kepada Yth: ${name}`;
  const rsvpName = document.querySelector('#rsvpForm input[name="name"]');
  if(rsvpName && !rsvpName.value) rsvpName.value = name;
}

/***********************
 * KAIZEN: Full-colour Kids FX Canvas (stars / crescents / lanterns / confetti)
 * - no creatures, no eyes
 * - drawn as abstract shapes
 ***********************/
function initKidsFx(){
  const canvas = document.getElementById("kidsFx");
  const btnFx  = document.getElementById("btnFx");
  if(!canvas) return;

  // Default: ON (biar undangan terasa hidup). Bisa dimatikan via tombol ✨.
  let fxOn = true;
  try{
    const stored = localStorage.getItem("rbm_fx");
    if(stored === "0") fxOn = false;
    if(stored === "1") fxOn = true;
  }catch(_e){}

  const prefersReduce = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

  let ctx=null, W=0, H=0, DPR=1;
  let rafId = 0;
  let pruneId = 0;
  let running = false;
  let parts = [];

  const palette = [
    "rgb(255, 64, 129)",   // pink
    "rgb(255, 179, 0)",    // gold
    "rgb(0, 191, 255)",    // sky
    "rgb(99, 102, 241)",   // indigo
    "rgb(34, 197, 94)",    // green
    "rgb(255, 99, 72)",    // coral
    "rgb(168, 85, 247)",   // purple
    "rgb(255, 214, 10)"    // bright yellow
  ];

  const rand = (a,b)=> a + Math.random()*(b-a);
  const pick = (arr)=> arr[(Math.random()*arr.length)|0];

  function updateBtn(){
    if(!btnFx) return;
    btnFx.classList.toggle("active", fxOn);
    btnFx.textContent = fxOn ? "✨" : "✦";
    btnFx.title = fxOn ? "FX: ON" : "FX: OFF";
  }

  function resize(){
    DPR = Math.min(2, window.devicePixelRatio || 1);
    W = Math.floor(innerWidth);
    H = Math.floor(innerHeight);
    canvas.width  = Math.floor(W * DPR);
    canvas.height = Math.floor(H * DPR);
    canvas.style.width = W + "px";
    canvas.style.height = H + "px";
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }

  function drawStar(x,y,r,rot,color,alpha=1){
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(rot);
    ctx.globalAlpha = alpha;

    // glow (supaya nyata kelihatan)
    ctx.shadowBlur = 14;
    ctx.shadowColor = color;

    ctx.fillStyle = color;
    const spikes = 5, inner = r*0.48;
    ctx.beginPath();
    for(let i=0;i<spikes*2;i++){
      const ang = (Math.PI/spikes)*i;
      const rr = (i%2===0) ? r : inner;
      ctx.lineTo(Math.cos(ang)*rr, Math.sin(ang)*rr);
    }
    ctx.closePath();
    ctx.fill();

    // tiny highlight
    ctx.shadowBlur = 0;
    ctx.globalAlpha = alpha*0.35;
    ctx.fillStyle = "rgba(255,255,255,.9)";
    ctx.beginPath();
    ctx.arc(-r*0.15, -r*0.18, Math.max(1.2, r*0.16), 0, Math.PI*2);
    ctx.fill();

    ctx.restore();
  }

  function drawCrescent(x,y,r,rot,color,alpha=1){
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(rot);
    ctx.globalAlpha = alpha;

    ctx.shadowBlur = 10;
    ctx.shadowColor = color;

    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.arc(0,0,r,0,Math.PI*2);
    ctx.fill();

    ctx.globalCompositeOperation = "destination-out";
    ctx.beginPath();
    ctx.arc(r*0.36,0,r*0.92,0,Math.PI*2);
    ctx.fill();

    ctx.restore();
    ctx.globalCompositeOperation = "source-over";
  }

  function roundRect(x,y,w,h,r){
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+rr,y);
    ctx.arcTo(x+w,y,x+w,y+h,rr);
    ctx.arcTo(x+w,y+h,x,y+h,rr);
    ctx.arcTo(x,y+h,x,y,rr);
    ctx.arcTo(x,y,x+w,y,rr);
    ctx.closePath();
  }

  function drawLantern(x,y,s,rot,color,alpha=1){
    // abstrak, no eyes/no creature
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(rot);
    ctx.globalAlpha = alpha;

    ctx.shadowBlur = 16;
    ctx.shadowColor = color;

    const w = s*0.72, h = s*0.92;
    const r = Math.max(6, s*0.18);

    ctx.fillStyle = color;
    roundRect(-w/2,-h/2,w,h,r);
    ctx.fill();

    // soft vertical stripes (biar kaya lampion, tapi bukan “mata”)
    ctx.shadowBlur = 0;
    ctx.globalAlpha = alpha*0.45;
    ctx.strokeStyle = "rgba(255,255,255,.35)";
    ctx.lineWidth = Math.max(1.4, s*0.06);
    ctx.beginPath();
    ctx.moveTo(-w*0.18, -h*0.34); ctx.lineTo(-w*0.18, h*0.34);
    ctx.moveTo( w*0.18, -h*0.34); ctx.lineTo( w*0.18, h*0.34);
    ctx.stroke();

    // tassel
    ctx.globalAlpha = alpha*0.60;
    ctx.beginPath();
    ctx.moveTo(0, h*0.48);
    ctx.lineTo(0, h*0.66);
    ctx.stroke();

    ctx.restore();
  }

  function pickX(){
    // biar kelihatan di HP juga: sebagian lewat area tengah (lebih soft di tengah)
    const edgeBias = (W < 620) ? 0.35 : 0.55;
    if(Math.random() < edgeBias){
      const side = Math.random() < 0.5;
      const pad = Math.min(170, W*0.22);
      return side ? rand(-30, pad) : rand(W-pad, W+30);
    }
    return rand(-10, W+10);
  }

  function makeParticle(yInit){
    const t = Math.random();
    const type =
      t < 0.56 ? "star" :
      t < 0.80 ? "confetti" :
      t < 0.92 ? "crescent" :
      "lantern";

    const size = type==="lantern" ? rand(24, 46) : rand(12, 28);
    const speedScale = prefersReduce ? 0.55 : 1;

    return {
      type,
      x: pickX(),
      y: (typeof yInit==="number") ? yInit : rand(-H, H),
      s: size,
      rot: rand(-1.2, 1.2),
      vr: rand(-0.020, 0.020) * speedScale,
      vy: rand(0.40, 0.98) * speedScale,
      vx: rand(-0.22, 0.22) * speedScale,
      wob: rand(0.8, 1.8),
      ph: rand(0, Math.PI*2),
      c: pick(palette),
      a: (type==="lantern") ? rand(0.26, 0.40) : rand(0.28, 0.48)
    };
  }

  function seed(){
    const N = Math.max(52, Math.min(92, Math.floor(W/11)));
    parts = Array.from({length:N}, ()=> makeParticle(rand(-H, H)));
  }

  function start(){
    if(running) return;
    running = true;

    canvas.style.display = "block"; // override prefers-reduced-motion CSS if needed
    ctx = canvas.getContext("2d", { alpha:true });

    resize();
    window.addEventListener("resize", resize, { passive:true });

    seed();

    function tick(t){
      ctx.clearRect(0,0,W,H);

      // soft full-colour glows (lebih “kids”)
      ctx.save();
      ctx.globalAlpha = 0.10;
      for(let i=0;i<14;i++){
        const gx = rand(0, W);
        const gy = rand(0, H);
        ctx.fillStyle = pick(palette);
        ctx.beginPath();
        ctx.arc(gx, gy, rand(1.4, 2.8), 0, Math.PI*2);
        ctx.fill();
      }
      ctx.restore();

      for(const p of parts){
        p.y += p.vy;
        p.x += p.vx + Math.sin(t*0.0014 + p.ph) * p.wob;
        p.rot += p.vr;

        if(p.y > H + 70){
          Object.assign(p, makeParticle(rand(-140,-30)));
        }

        if(p.x < -140) p.x = W + 140;
        if(p.x > W + 140) p.x = -140;

        // lebih soft di tengah (biar teks tetap nyaman)
        let alpha = p.a;
        if(p.x > W*0.18 && p.x < W*0.82) alpha *= 0.62;
        alpha *= (0.80 + 0.20*Math.sin(t*0.002 + p.ph));

        if(p.type === "star"){
          drawStar(p.x,p.y,p.s, p.rot, p.c, alpha);
        }else if(p.type === "crescent"){
          drawCrescent(p.x,p.y, p.s*0.62, p.rot, p.c, alpha);
        }else if(p.type === "lantern"){
          drawLantern(p.x,p.y, p.s, p.rot*0.55, p.c, alpha*0.95);
        }else{
          // confetti (rect)
          ctx.save();
          ctx.translate(p.x,p.y);
          ctx.rotate(p.rot);
          ctx.globalAlpha = alpha;
          ctx.fillStyle = p.c;
          ctx.shadowBlur = 8;
          ctx.shadowColor = p.c;
          ctx.fillRect(-p.s*0.5, -p.s*0.18, p.s, p.s*0.36);
          ctx.restore();
        }
      }

      rafId = requestAnimationFrame(tick);
    }

    rafId = requestAnimationFrame(tick);

    // burst API for open button
    window.__kidsFxBurstAt = function(x,y){
      if(!running) return;
      const burstN = 22;
      for(let i=0;i<burstN;i++){
        const p = makeParticle(y);
        p.x = x; p.y = y;
        const ang = rand(0, Math.PI*2);
        const spd = rand(1.4, 3.2);
        p.vx = Math.cos(ang)*spd;
        p.vy = Math.sin(ang)*spd;
        p.wob = rand(0.2, 0.9);
        p.a = rand(0.34, 0.55);
        p.s = p.type==="lantern" ? rand(18,30) : rand(10,18);
        p.vr = rand(-0.08, 0.08);
        p.life = 0;
        p.maxLife = rand(55, 90);
        parts.push(p);
      }
    };

    // prune burst particles
    function prune(){
      if(!running) return;
      for(let i=parts.length-1;i>=0;i--){
        const p = parts[i];
        if(p.maxLife){
          p.life++;
          p.vx *= 0.985; p.vy *= 0.985;
          if(p.life > p.maxLife) parts.splice(i,1);
        }
      }
      pruneId = requestAnimationFrame(prune);
    }
    pruneId = requestAnimationFrame(prune);
  }

  function stop(){
    running = false;
    try{ cancelAnimationFrame(rafId); }catch(_e){}
    try{ cancelAnimationFrame(pruneId); }catch(_e){}
    try{ window.removeEventListener("resize", resize); }catch(_e){}
    try{
      if(ctx) ctx.clearRect(0,0,W,H);
    }catch(_e){}
    canvas.style.display = "none";
    window.__kidsFxBurstAt = function(){};
  }

  function setFx(on){
    fxOn = !!on;
    try{ localStorage.setItem("rbm_fx", fxOn ? "1" : "0"); }catch(_e){}
    updateBtn();
    fxOn ? start() : stop();
  }

  if(btnFx){
    btnFx.addEventListener("click", (e)=>{
      addRipple(e);
      setFx(!fxOn);
    });
  }

  updateBtn();
  setFx(fxOn);
}

/***********************
 * Init
 ***********************/
setLang("id");
$("#addrText").textContent = CONFIG.addressLine;
$("#btnMap").href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(CONFIG.mapQuery)}`;

renderClasses();
renderGallery();
startSlides();
startCountdown();
initReveal();
initBottomNav();
initKidsFx();
// KAIZEN: extra colourful burst on open (background only)
try{
  const _b = document.getElementById("btnOpen");
  if(_b){
    _b.addEventListener("click", ()=>{
      if(window.__kidsFxBurstAt){
        window.__kidsFxBurstAt(innerWidth/2, innerHeight*0.35);
        window.__kidsFxBurstAt(innerWidth*0.20, innerHeight*0.30);
        window.__kidsFxBurstAt(innerWidth*0.80, innerHeight*0.30);
      }
    }, { passive:true });
  }
}catch(_e){}
  </script>
</body>
</html>
