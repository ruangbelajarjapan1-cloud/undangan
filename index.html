<script>
    // --- 1. SETTING URL (GANTI INI DENGAN URL BARU ANDA!) ---
    const CONFIG = {
      ENDPOINT: "https://script.google.com/macros/s/AKfycbwGA8_bsewf_rmdF4DbRQoT0pRR2dQ03DUHRwZIJP0K847smDncQWiNQzur9Cl34eKu/exec", // <-- PASTE URL DISINI
      photos: ["01.jpg", "02.jpg", "03.jpg","a.jpeg","b.jpeg","c.jpeg","d.jpeg","e.jpeg","f.jpeg","g.jpeg","h.jpeg"] // (Sesuai config foto Anda sebelumnya)
    };

    // --- 2. LOAD DATA TAMU (GET) ---
    async function loadGuests() {
      const listContainer = document.getElementById('guestList'); // Pastikan ada div dengan ID ini di HTML
      if(!listContainer) return;

      listContainer.innerHTML = '<div class="empty-msg">Memuat data...</div>';

      try {
        // Panggil script dengan mode=get_guests
        const response = await fetch(CONFIG.ENDPOINT + "?mode=get_guests");
        const json = await response.json();

        if (json.result === 'success' && json.data.length > 0) {
          listContainer.innerHTML = ''; 
          json.data.forEach(guest => {
            // Render kartu tamu
            const div = document.createElement('div');
            div.className = 'guest-item'; // Pastikan ada CSS untuk class ini
            div.innerHTML = `
              <div class="guest-name" style="font-weight:bold; color:#0F766E;">${guest.name}</div>
              <div class="guest-msg" style="font-style:italic; font-size:13px;">"${guest.message || 'Hadir'}"</div>
              <hr style="opacity:0.2; margin:5px 0;">
            `;
            listContainer.appendChild(div);
          });
        } else {
          listContainer.innerHTML = '<div class="empty-msg">Belum ada tamu yang terdaftar.</div>';
        }
      } catch (e) {
        console.error(e);
        listContainer.innerHTML = '<div class="empty-msg">Gagal memuat data.</div>';
      }
    }

    // --- 3. KIRIM DATA (POST) ---
    document.getElementById('rsvpForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const btn = this.querySelector('button[type="submit"]');
      const originalText = btn.innerText;
      btn.innerText = "⏳ Mengirim...";
      btn.disabled = true;

      // Ambil data form
      const formData = new FormData(this);
      
      // Kirim ke Google Script
      fetch(CONFIG.ENDPOINT, {
        method: 'POST',
        body: formData,
        mode: 'no-cors' // Wajib 'no-cors' agar tidak error cross-origin
      }).then(() => {
        // SUKSES (Karena no-cors tidak mengembalikan status, kita asumsikan sukses jika tidak error network)
        alert("✅ Konfirmasi Berhasil Terkirim!");
        
        // Reset form
        this.reset();
        
        // Reload daftar tamu otomatis
        loadGuests(); 

        // Tampilkan tiket (dari kode sebelumnya)
        if(typeof showTicket === 'function') {
            showTicket(formData.get('name'));
        }

      }).catch(err => {
        alert("Gagal koneksi. Coba lagi.");
        console.error(err);
      }).finally(() => {
        btn.innerText = originalText;
        btn.disabled = false;
      });
    });

    // Panggil saat halaman dibuka
    window.addEventListener('load', () => {
        loadGuests();
        // ... fungsi init lainnya (setLang, openApp, dll)
    });

</script>
